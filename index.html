<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë¸”ë£¨ ì•„ì¹´ì´ë¸Œ ì˜ìˆ˜ì¦ ìƒì„±ê¸°</title>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<!--/* Version: 1.13 */-->


<style>
    body { background-color: #333; margin: 0; display: flex; height: 100vh; overflow: hidden; font-family: 'NexonLv2Gothic', 'Malgun Gothic', sans-serif; }
    .input-panel { width: 640px; background-color: #f5f5f5; padding: 20px; overflow-y: auto; border-right: 1px solid #ccc; box-sizing: border-box; display: flex; flex-direction: column; gap: 15px; }
    .preview-panel { flex: 1; background-color: #555; display: flex; justify-content: center; align-items: flex-start; padding: 40px; overflow-y: auto; }

    .input-group { background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .input-group h3 { margin: 0 0 10px 0; font-size: 15px; color: #000; border-bottom: 2px solid #333; padding-bottom: 5px; }
    
    .single-item-box { display: flex; justify-content: space-between; align-items: center; padding: 15px; }
    .single-item-box label { font-size: 14px; font-weight: bold; color: #000; margin: 0; }
    
    .input-with-unit { display: flex; align-items: center; background: #fff; border: 1px solid #ddd; border-radius: 4px; padding: 0 8px; width: 170px; box-sizing: border-box; }
    .input-with-unit input { border: none !important; text-align: right; width: 100%; padding: 6px 2px; font-family: 'NexonLv2Gothic', sans-serif; outline: none; font-size: 13px; }
    .input-with-unit span { font-size: 12px; color: #888; margin-left: 4px; font-weight: bold; white-space: nowrap; }

    .input-row { display: flex; flex-direction: column; margin-bottom: 10px; }
    .input-row label, .col label { font-size: 12px; font-weight: bold; color: #333; margin-bottom: 4px; }
    .input-row input, .input-row select, .col input, .col select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: 'NexonLv2Gothic', sans-serif; box-sizing: border-box; width: 100%; }
    .input-row textarea { height: 190px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: 'NexonLv2Gothic', sans-serif; line-height: 1.4;}
	#in-fav-raw { resize: none !important; }
    
    .input-row-horizontal { display: flex; gap: 8px; margin-bottom: 10px; }
    .col { display: flex; flex-direction: column; }
    .skill-inputs { display: flex; gap: 5px; }
    .skill-inputs input { text-align: center; flex: 1; }

    .story-input-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; padding-bottom: 6px; border-bottom: 1px solid #f9f9f9; }
    .story-label { font-size: 12px; color: #333; font-weight: bold; flex: 1; margin-right: 10px; }
    .story-inputs { display: flex; align-items: center; gap: 5px; font-size: 11px; color: #666; }
    .input-mini { width: 40px; text-align: center; padding: 4px; border: 1px solid #ddd; border-radius: 3px; font-family: 'NexonLv2Gothic', sans-serif; }

    button { cursor: pointer; border: none; border-radius: 4px; font-weight: bold; transition: 0.2s; }
    button.btn-add { background-color: #333; color: white; padding: 12px; width: 100%; margin-top: 10px; }
    button.btn-add:hover { background-color: #000; }
    button.btn-add.edit-mode { background-color: #2b6cb0; }
    button.btn-reset { background-color: #d9534f; color: white; padding: 8px; width: 100%; margin-top: 20px; font-size: 12px; }
    button.btn-save { background-color: #2b6cb0; color: white; padding: 15px; width: 100%; font-size: 14px; margin-top: 10px; }
    button.btn-save:hover { background-color: #1a4971; }

	.student-manage-list { 
        margin-top: 15px; 
        border-top: 1px dashed #ccc; 
        padding-top: 15px; 
        
        max-height: 710px;
        overflow-y: auto;
        
        padding-right: 5px; 
        border-bottom: 1px dashed #ccc;
    }
    .manage-item { display: flex; justify-content: space-between; align-items: center; background: #f9f9f9; border: 1px solid #eee; padding: 8px 10px; margin-bottom: 5px; border-radius: 4px; font-size: 120px; }
    .manage-name { font-weight: bold; color: #fff; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 280px; font-size: 13px !important; line-height: 1.4;}
    .manage-btns { display: flex; gap: 5px; }
    .btn-mini { padding: 4px 8px; border-radius: 3px; font-size: 11px; color: white; }
    .btn-del { background-color: #d9534f; }

    .raid-list-wrapper { max-height: 300px; overflow-y: scroll; border: 1px solid #ddd; border-radius: 4px; padding: 5px; background: #fafafa; }
    .raid-input-item { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; border-bottom: 1px solid #eee; font-size: 12px; }
    .raid-input-item:last-child { border-bottom: none; }
    .raid-label { flex: 1; color: #333; font-weight: bold; }
    .raid-select { width: 100px; padding: 2px; font-size: 11px; }
    .raid-num-input { width: 80px; padding: 3px; font-size: 11px; text-align: right; border: 1px solid #ccc; border-radius: 3px; font-family: 'NexonLv2Gothic', sans-serif; }

    @font-face { font-family: 'NexonLv2Gothic'; src: url('NexonLv2Gothic.ttf') format('truetype'); font-weight: normal; font-style: normal; }
    @font-face { font-family: 'NexonLv2GothicBold'; src: url('NexonLv2GothicBold.ttf') format('truetype'); font-weight: normal; font-style: normal; }

    .receipt { background-color: #fff; width: 380px; padding: 40px 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); position: relative; color: #000; box-sizing: border-box; margin-bottom: 50px; background: white; }
    .header-logo { text-align: center; margin-bottom: 20px; }
    .header-logo img { max-width: 80%; height: auto; }
    .date-row { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 5px; margin-top: 30px; }
    .dashed-line { border: none; border-top: 1px dashed #000; border-bottom: 1px dashed #000; height: 5px; margin: 10px 0 30px 0; background: none; }
    .game-logo { text-align: left; margin-bottom: 8px; }
    .game-logo img { max-width: 150px; height: auto; }
    .data-box { border: 1px solid #000; padding: 15px; font-size: 13px; line-height: 1.0; margin-bottom: 30px; }
    .data-row { display: flex; justify-content: space-between; margin-bottom: 8px; }
    .data-row:last-child { margin-bottom: 0; }
    .label { color: #000; }
    .value { text-align: right; }

    .record-title { background-color: #000; color: #fff; font-family: 'NexonLv2GothicBold', sans-serif; font-weight: normal; display: inline-block; padding-top: 2px; padding-bottom: 2px; padding-left: 6px; padding-right: 7px; font-size: 13px; vertical-align: middle; }
    .record-subtitle { font-size: 11px; color: #777; margin-top: 5px; margin-bottom: 16px; letter-spacing: -0.8px; }
    .record-subtitle-inline { font-size: 11px; color: #777; margin-left: 1px; vertical-align: bottom; }

    .student-entry { font-size: 13px; line-height: 19px;}
    .student-name { font-size: 13px; font-weight: normal; line-height: 19px; }
    .record-row { display: flex; justify-content: space-between; line-height: 19px; }
    .record-label { font-size: 13px; padding-left: 5px; }
    .record-value { text-align: right; font-size: 13px; line-height: 19px; }

    .record-section { margin-bottom: 40px; }
    .fav-list { font-size: 13px; line-height: 19px; white-space: pre-wrap; margin-top: 13px; }

    .life-sub-header {
        font-size: 13px; font-weight: normal; color: #000;
        line-height: 19px;
        font-family: 'NexonLv2Gothic', sans-serif; 
    }
    .trophy-list { font-size: 13px; line-height: 19px; padding-left: 8px; }
    .trophy-row { display: flex; justify-content: space-between; }
    .trophy-rank { text-align: right; }

    .record-label-bold { font-family: 'NexonLv2Gothic', sans-serif; font-size: 13px; color: #000; font-weight: normal; }
    
    .simple-row { display: flex; justify-content: space-between; align-items: center; }
	.simple-row label { font-size: 13px; font-weight: bold; color: #;}
    .dashed-hr { border: 0; border-top: 1px dashed #ddd; margin: 8px 0; }

    .tight-list { font-size: 13px; line-height: 19px; }
	
    .dynamic-list-item { 
        display: flex; 
        gap: 5px; 
        margin-bottom: 6px; 
        align-items: center; 
        background: #fff;
        border: 1px solid #eee;
        padding: 4px 6px;
        border-radius: 6px;
        box-shadow: 0 1px 2px rgba(0,0,0,0.03);
        transition: background 0.2s, transform 0.2s;
    }
    .dynamic-list-item:hover {
        box-shadow: 0 3px 6px rgba(0,0,0,0.06);
    }
    .dynamic-list-item.dragging {
        opacity: 0.5;
        background: #f9f9f9;
        border: 1px dashed #999;
    }

    .dynamic-list-item input[type="text"] { 
        flex: 2; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; height: 15px; 
    }
    .dynamic-list-item input[type="number"] { 
        flex: 1; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: right; height: 15px; 
    }
	
    .btn-add-row { 
        background-color: #f9f9f9; 
        color: #555; 
        border: 1px dashed #999; 
        padding: 8px; 
        width: 100%; 
        border-radius: 4px; 
        cursor: pointer; 
        margin-top: 5px; 
        font-size: 12px; 
    }
    .btn-add-row:hover { background-color: #eee; }
	
	.gift-manage-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #fff;
        border: 1px solid #ddd;
        padding: 8px;
        margin-bottom: 5px;
        border-radius: 4px;
        cursor: move;
        transition: background-color 0.2s;
    }
    .gift-manage-item:hover {
        background-color: #f0f8ff; 
    }
    .gift-manage-item.dragging {
        opacity: 0.5;
        background-color: #e0e0e0;
        border: 2px dashed #999;
    }
    
    .gift-info {
        flex: 1;
        font-size: 12px;
        display: flex;
        flex-direction: column;
        gap: 2px;
    }
    .gift-name-text { font-weight: bold; color: #333; }
    .gift-count-text { color: #666; }
	
	#gift-manage-container {
        border-top: 1px dashed #ddd; 
        padding-top: 10px;
        margin-top: 10px;
        
        max-height: 710px;
        overflow-y: auto;
        padding-right: 5px; 
    }
	
	.btn-move-gift {
        background-color: #f0f0f0;
        color: #555;
        border: 1px solid #ccc;
        border-radius: 4px;
        width: 28px; 
        height: 28px;
        cursor: pointer;
        font-size: 14px;
        margin-left: 2px;
    }
    .btn-move-gift:hover { background-color: #e0e0e0; }
    
    .btn-remove-gift {
        background-color: #ff6b6b;
        color: white;
        border: none;
        border-radius: 4px;
        width: 28px; height: 28px;
        cursor: pointer;
        font-weight: bold;
        margin-left: 10px;
    }
	
	button.btn-preview { 
        background-color: #27ae60;
        color: white; 
        padding: 15px; 
        width: 100%; 
        border: none; 
        border-radius: 4px; 
        cursor: pointer; 
        font-weight: bold; 
        font-size: 14px; 
        margin-top: 20px;
        margin-bottom: 5px;
    }
    button.btn-preview:hover { background-color: #219150; }
	
	.underlined-text {
        font-weight: bold;
        color: #000;
        position: relative;
        display: inline-block;
        text-decoration: none;
        border-bottom: none;
    }

    .underlined-text::after {
        content: "";
        display: block;
        position: absolute;
        left: 0;
        width: 100%;
        height: 1px;
        background: #000;
        bottom: 1px; 
    }
	
    .search-wrapper {
        position: relative;
        flex: 2;
    }
    .search-results {
        position: absolute;
        top: 100%; left: 0; right: 0;
        background: white;
        border: 1px solid #ccc;
        border-radius: 4px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .search-item {
        padding: 8px;
        font-size: 12px;
        border-bottom: 1px solid #eee;
        cursor: pointer;
        color: #333;
    }
    .search-item:hover {
        background-color: #f0f8ff;
    }
	.search-item.active {
        background-color: #e6f7ff;
        font-weight: bold;
        color: #000;
    }
	
	.btn-scroll-top {
        width: 100%;
        padding: 8px;
        margin-top: 10px;
        background-color: #7f8c8d;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        font-weight: bold;
    }
    .btn-scroll-top:hover {
        background-color: #607d8b;
    }
	
	.btn-edit-student {
        background-color: #f0f0f0;
        color: #555;
        border: 1px solid #ccc;
        border-radius: 4px;
        width: 28px; 
        height: 28px;
        cursor: pointer;
        font-size: 14px;
        margin-left: 2px;
		color: #2b6cb0;
    }
    .btn-edit-student:hover { background-color: #e6f7ff; }
	
	.drag-handle {
        margin-right: 10px !important;
    }

</style>
</head>
<body>

    <div class="input-panel">
        <h2 style="margin:0; font-size:20px;">ğŸ§¾ ì˜ìˆ˜ì¦ ë°ì´í„° ì…ë ¥</h2>
		
        <div class="input-group single-item-box">
            <label>DATE</label>
            <div class="input-with-unit"><input type="text" id="in-date"></div>
        </div>
        
	<div class="input-group">
            <h3>ë°•ìŠ¤ ë‚´ìš©</h3>
			<div class="input-row">
                <label>ë¸”ì•„ì™€ í•¨ê»˜í•œ ì§€</label>
                <div class="input-with-unit" style="width: 100%;">
                    <input type="text" id="in-nick">
                    <span style="font-size:11px;">ì„ ìƒë‹˜</span>
                </div>
            </div>
            <div class="input-row"><label>ì„ ìƒë‹˜ê»˜ì„œ ì²˜ìŒ ë¶€ì„ í•˜ì‹  ë‚ </label><input type="text" id="in-start" style=" text-align: right"></div>
            
            <div class="input-row">
                <label>ë¸”ì•„ì™€ í•¨ê»˜í•œ ì§€</label>
                <div class="input-with-unit" style="width: 100%;">
                    <input type="text" id="in-days">
                    <span style="font-size:11px;">ì¼</span>
                </div>
            </div>

            <div class="input-row">
                <label>ëˆ„ì  í”Œë ˆì´ ì‹œê°„</label>
                <div style="display: flex; gap: 5px;">
                    <div class="input-with-unit" style="flex: 1; width:auto;">
                        <input type="text" id="in-playtime-hour" placeholder="ì‹œê°„">
                        <span style="font-size:11px;">ì‹œê°„</span>
                    </div>
                    <div class="input-with-unit" style="flex: 1; width:auto;">
                        <input type="text" id="in-playtime-minute" placeholder="ë¶„">
                        <span style="font-size:11px;">ë¶„</span>
                    </div>
                </div>
            </div>

            <div class="input-row">
                <label>ë ˆë²¨</label>
                <div class="input-with-unit" style="width: 100%;">
                    <input type="text" id="in-level">
					<span style="font-size:11px;">Lv</span>
                </div>
            </div>

            <div class="input-row">
                <label>í•¨ê»˜í•œ í•™ìƒ ìˆ˜</label>
                <div class="input-with-unit" style="width: 100%;">
                    <input type="text" id="in-students">
                    <span style="font-size:11px;">ëª…</span>
                </div>
            </div>

            <div class="input-row"><label>í˜„ì¬ ê°€ì… ì„œí´</label><input type="text" id="in-circle" style=" text-align: right"></div>
        </div>

        <div class="input-group">
            <h3>ë‚˜ì˜ í•™ìƒë¶€ ê¸°ë¡</h3>
            <div class="input-row-horizontal">
                <div class="col" style="flex: 3;"><label>í•™ìƒ ì´ë¦„</label><input type="text" id="new-name" placeholder="ì˜ˆ: ì•„ì¸ ì½”(ìˆ˜ì˜ë³µ)"></div>
                <div class="col" style="flex: 1;"><label>ë ˆë²¨</label><input type="text" id="new-lvl" value="90"></div>
                <div class="col" style="flex: 2;">
                    <label>ì„±ê¸‰</label>
                    <select id="new-star">
                        <option value="1ì„±">1ì„±</option><option value="2ì„±">2ì„±</option><option value="3ì„±">3ì„±</option><option value="4ì„±">4ì„±</option><option value="5ì„±">5ì„±</option>
                        <option value="ì „ë¬´1">ì „ë¬´ 1ì„±</option><option value="ì „ë¬´2">ì „ë¬´ 2ì„±</option><option value="ì „ë¬´3">ì „ë¬´ 3ì„±</option><option value="ì „ë¬´4" selected>ì „ë¬´ 4ì„±</option>
                    </select>
                </div>
            </div>
            <div class="input-row">
                <label>ìŠ¤í‚¬ (EX / 1ìŠ¤ / 2ìŠ¤ / 3ìŠ¤)</label>
                <div class="skill-inputs"><input type="text" id="sk-ex" value="M"><input type="text" id="sk-1" value="M"><input type="text" id="sk-2" value="M"><input type="text" id="sk-3" value="M"></div>
            </div>
            <div class="input-row">
                <label>ëª¨ëª¨í†¡ ì§„í–‰ë„</label>
                <select id="new-momo">
                    <option value="1">EP 1 ì™„ë£Œ</option><option value="2">EP 2 ì™„ë£Œ</option><option value="3">EP 3 ì™„ë£Œ</option>
                    <option value="4">EP 4 ì™„ë£Œ</option><option value="5">EP 5 ì™„ë£Œ</option><option value="6">EP 6 ì™„ë£Œ</option>
					<option value="7">EP 7 ì™„ë£Œ</option><option value="none">ì•ˆ ë´„</option>
                </select>
            </div>
            <button class="btn-add" id="main-btn" onclick="addOrUpdateStudent()">â¬‡ ëª©ë¡ì— ì¶”ê°€í•˜ê¸°</button>
			<div id="student-count-display" style="text-align: right; font-size: 14px; color: #333; margin-top: 10px; display: none;"></div>
            <div class="student-manage-list"><div id="manage-list-container"></div></div>
			
			<button class="btn-scroll-top" onclick="goToStudentInput()">â¬† í•™ìƒ ì…ë ¥ì°½ìœ¼ë¡œ ì´ë™</button>
        </div>

        <div class="input-group">
            <h3>ë‚˜ì˜ ìµœì•  í•™ìƒ ê¸°ë¡</h3>
            <div class="input-row"><textarea id="in-fav-raw" placeholder="ì˜ˆ: 1ë“±. ì•„ì¸ ì½”..."></textarea></div>
        </div>

	<div class="input-group" style="background-color: #f0f7ff; border:1px solid #cce5ff;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                <h3 style="margin:0; border:none; padding:0;">ì´ë ¥ì „ ì—­ëŒ€ íŠ¸ë¡œí”¼</h3>
                <div style="display:flex; gap:5px;">
                    <button onclick="fillAllRaids('ba_receipt_raid', 'ê³¨ë“œ')" style="padding:4px 8px; font-size:14px; background:#f1c40f; color:black; border:none; border-radius:3px; cursor:pointer; font-weight:bold;">ê¿€í†µë‹¨</button>
                    <button onclick="fillAllRaids('ba_receipt_raid', 'í”Œë˜í‹°ë„˜')" style="padding:4px 8px; font-size:14px; background:#A52A2A; color:white; border:none; border-radius:3px; cursor:pointer; font-weight:bold;">ë¸”ì•…ê·€</button>
                </div>
            </div>
            <p style="font-size:11px; color:#666; margin:0 0 5px 0;">ì•„ë˜ ëª©ë¡ì—ì„œ íšë“í•œ íŠ¸ë¡œí”¼ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
            <div class="raid-list-wrapper" id="raid-select-container"></div>
        </div>

        <div class="input-group" style="background-color: #f7f0ff; border:1px solid #e0ccff;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                <h3 style="margin:0; border:none; padding:0;">ëŒ€ê²°ì „ ì—­ëŒ€ íŠ¸ë¡œí”¼</h3>
                <div style="display:flex; gap:5px;">
                    <button onclick="fillAllRaids('ba_receipt_grand_raid', 'ê³¨ë“œ')" style="padding:4px 8px; font-size:14px; background:#f1c40f; color:black; border:none; border-radius:3px; cursor:pointer; font-weight:bold;">ê¿€í†µë‹¨</button>
                    <button onclick="fillAllRaids('ba_receipt_grand_raid', 'í”Œë˜í‹°ë„˜')" style="padding:4px 8px; font-size:14px; background:#A52A2A; color:white; border:none; border-radius:3px; cursor:pointer; font-weight:bold;">ë¸”ì•…ê·€</button>
                </div>
            </div>
            <p style="font-size:11px; color:#666; margin:0 0 5px 0;">ì•„ë˜ ëª©ë¡ì—ì„œ íšë“í•œ íŠ¸ë¡œí”¼ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
            <div class="raid-list-wrapper" id="grand-raid-select-container"></div>
        </div>

        <div class="input-group single-item-box">
            <label>ìŠ¤ì¼€ì¤„ ì§„í–‰ íšŸìˆ˜</label>
            <div class="input-with-unit"><input type="text" id="in-schedule"><span>íšŒ</span></div>
        </div>
        <div class="input-group single-item-box">
            <label>ì„œí´ ì¶œì„ íšŸìˆ˜</label>
            <div class="input-with-unit"><input type="text" id="in-circle-attend"><span>íšŒ</span></div>
        </div>
        <div class="input-group single-item-box">
            <label>ì œì¡° ì§„í–‰ íšŸìˆ˜</label>
            <div class="input-with-unit"><input type="text" id="in-crafting"><span>íšŒ</span></div>
        </div>
        <div class="input-group single-item-box">
            <label>í˜„ìƒ ìˆ˜ë°° ì„ë¬´ í´ë¦¬ì–´ íšŸìˆ˜</label>
            <div class="input-with-unit"><input type="text" id="in-bounty"><span>íšŒ</span></div>
        </div>
        <div class="input-group single-item-box">
            <label>íŠ¹ë³„ì˜ë¢° ì„ë¬´ í´ë¦¬ì–´ íšŸìˆ˜</label>
            <div class="input-with-unit"><input type="text" id="in-special"><span>íšŒ</span></div>
        </div>
        <div class="input-group single-item-box">
            <label>í•™ì› êµë¥˜íšŒ ì„ë¬´ í´ë¦¬ì–´ íšŸìˆ˜</label>
            <div class="input-with-unit"><input type="text" id="in-school"><span>íšŒ</span></div>
        </div>
        <div class="input-group">
            <div class="simple-row">
                <label>ì¢…í•©ì „ìˆ ì‹œí—˜ ì„ë¬´ í´ë¦¬ì–´ íšŸìˆ˜</label>
                <div class="input-with-unit"><input type="text" id="in-drill"><span>íšŒ</span></div>
            </div>
            <hr class="dashed-hr">
            <div class="simple-row">
                <label style="padding-left: 10px; color:#666;">ã†ë‹¬ì„± ìµœê³  ì ìˆ˜</label>
                <div class="input-with-unit"><input type="text" id="in-drill-max"><span>ì </span></div>
            </div>
            <div class="simple-row" style="margin-top:8px;">
                <label style="padding-left: 10px; color:#666;">ã†ëˆ„ì  ì ìˆ˜</label>
                <div class="input-with-unit"><input type="text" id="in-drill-total"><span>ì </span></div>
            </div>
        </div>

        <div class="input-group" style="background-color: #fff9e6; border:1px solid #ffeebb;">
            <h3>ì œì•½í•´ì œê²°ì „ ì—­ëŒ€ ê¸°ë¡</h3>
            <p style="font-size:11px; color:#666; margin:0 0 5px 0;">í´ë¦¬ì–´í•œ ë‹¨ê³„ë¥¼ ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš” (ì˜ˆ: 74). ë¯¸ì…ë ¥ì‹œ ì¶œë ¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
            <div class="raid-list-wrapper" id="elimination-raid-select-container"></div>
        </div>

        <div class="input-group">
            <div class="simple-row">
                <label>ì„ë¬´(ë…¸ë§) ì§„í–‰ íšŸìˆ˜</label>
                <div class="input-with-unit"><input type="text" id="in-mission-normal"><span>íšŒ</span></div>
            </div>
            <hr class="dashed-hr">
            <div class="simple-row">
                <label style="padding-left: 10px; color:#666;">ã†ì†Œíƒ• íšŸìˆ˜</label>
                <div class="input-with-unit"><input type="text" id="in-mission-normal-sweep"><span>íšŒ</span></div>
            </div>
        </div>
        <div class="input-group">
            <div class="simple-row">
                <label>ì„ë¬´(í•˜ë“œ) ì§„í–‰ íšŸìˆ˜</label>
                <div class="input-with-unit"><input type="text" id="in-mission-hard"><span>íšŒ</span></div>
            </div>
            <hr class="dashed-hr">
            <div class="simple-row">
                <label style="padding-left: 10px; color:#666;">ã†ì†Œíƒ• íšŸìˆ˜</label>
                <div class="input-with-unit"><input type="text" id="in-mission-hard-sweep"><span>íšŒ</span></div>
            </div>
        </div>
        <div class="input-group">
            <h3>ë©”ì¸ ìŠ¤í† ë¦¬ ì§„í–‰ë„</h3>
            <div id="main-story-input-container"></div>
        </div>
        <div class="input-group">
            <h3>ì´ë²¤íŠ¸ ì—í”¼ì†Œë“œ ì§„í–‰ë„</h3>
            <div id="event-story-input-container"></div>
        </div>
		<div class="input-group">
            <h3>ë¯¸ë‹ˆ ìŠ¤í† ë¦¬ ì§„í–‰ë„</h3>
            <div id="mini-story-input-container"></div>
        </div>
        <div class="input-group">
            <h3>ê·¸ë£¹ ìŠ¤í† ë¦¬ ì§„í–‰ë„</h3>
            <div id="group-story-input-container"></div>
        </div>
		
		<div class="input-group">
            <h3>ì—­ëŒ€ ì½œë¼ë³´ í˜¸ê°ë„ ì•„ì´í…œ</h3>
            <p style="font-size:12px; color:#666; margin:0 0 5px 0;">
                ì½œë¼ë³´ ì•„ì´í…œì„ ê²€ìƒ‰í•´ì„œ ì¶”ê°€í•˜ì„¸ìš”.<br>
                ì¶”ê°€ëœ í•­ëª©ì€ <b>ë§ˆìš°ìŠ¤ë¡œ ëŒì–´ì„œ ìˆœì„œë¥¼ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</b>
            </p>
            
            <div style="display:flex; gap:5px; margin-bottom:10px; align-items: center;">
                <div class="search-wrapper">
                    <input type="text" id="collab-search-input" placeholder="ì•„ì´í…œ ê²€ìƒ‰ (ì˜ˆ: ì¹´ë“œ)" autocomplete="off"
                           style="width:100%; padding:6px; border:1px solid #ddd; border-radius:4px; font-family:'NexonLv2Gothic', sans-serif; height:32px; box-sizing:border-box;">
                    <div id="collab-search-results" class="search-results"></div>
                </div>

                <input type="text" id="collab-count-input" placeholder="ì‚¬ìš© íšŸìˆ˜" class="input-with-unit" style="width: 100px; height:32px;">
                <button onclick="addSelectedCollab()" style="background:#333; color:white; border:none; border-radius:4px; padding:0 10px; cursor:pointer; height:32px;">+</button>
            </div>

            <div id="collab-manage-container" style="border-top:1px dashed #ddd; padding-top:10px; max-height: 505px; overflow-y: auto; padding-right: 5px;"></div>
		</div>
		
		<div class="input-group single-item-box">
            <label>ì²­íœ˜ì„ ì†Œëª¨ëŸ‰</label>
            <div class="input-with-unit">
                <input type="text" id="in-pyroxene">
                <span style="font-size:11px;">ê°œ</span>
            </div>
        </div>
        <div class="input-group single-item-box">
            <label>í¬ë ˆë”§ ì†Œëª¨ëŸ‰</label>
            <div class="input-with-unit">
                <input type="text" id="in-credit">
                <span style="font-size:11px;">í¬ë ˆë”§</span>
            </div>
        </div>
        <div class="input-group single-item-box">
            <label>AP ì†Œëª¨ëŸ‰</label>
            <div class="input-with-unit">
                <input type="text" id="in-ap">
                <span style="font-size:11px;">AP</span>
            </div>
        </div>

		<div class="input-group">
            <h3>ì„ ë¬¼ ì‚¬ìš© íšŸìˆ˜</h3>
            <p style="font-size:12px; color:#666; margin:0 0 5px 0;">
                ì„ ë¬¼ì„ ê²€ìƒ‰í•´ì„œ ì¶”ê°€í•˜ì„¸ìš”. <br>
                ì¶”ê°€ëœ í•­ëª©ì€ <b>ë§ˆìš°ìŠ¤ë¡œ ëŒì–´ì„œ ìˆœì„œë¥¼ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</b>
            </p>
            
		<div style="display:flex; gap:5px; margin-bottom:10px; align-items: center;">
                <div class="search-wrapper">
                    <input type="text" id="gift-search-input" placeholder="ì„ ë¬¼ ê²€ìƒ‰ (ì˜ˆ: ë² ê°œ)" 
                           autocomplete="off"
                           style="width:100%; padding:6px; border:1px solid #ddd; border-radius:4px; font-family:'NexonLv2Gothic', sans-serif; height:32px; box-sizing:border-box;">
                    <div id="gift-search-results" class="search-results"></div>
				</div>
                
				<input type="text" id="gift-count-input" placeholder="ì‚¬ìš© íšŸìˆ˜" class="input-with-unit" style="width: 100px; height:32px;">
                <button onclick="addSelectedGift()" style="background:#333; color:white; border:none; border-radius:4px; padding:0 10px; cursor:pointer; height:32px;">+</button>
            </div>
            <div id="gift-manage-container" style="border-top:1px dashed #ddd; padding-top:10px;"></div>
			
			<button class="btn-scroll-top" onclick="goToGiftInput()">â¬† ì„ ë¬¼ ì…ë ¥ì°½ìœ¼ë¡œ ì´ë™</button>
        </div>
		
		<div class="input-group single-item-box">
            <label>ì—˜ë¦¬ê·¸ë§ˆ ì†Œëª¨ëŸ‰</label>
            <div class="input-with-unit">
                <input type="text" id="in-eligma">
                <span style="font-size:11px;">ê°œ</span>
            </div>
        </div>

        <div class="input-group">
            <div class="simple-row">
                <label>ì´ë ¥ì „ ì½”ì¸ ì†Œëª¨ëŸ‰</label>
                <div class="input-with-unit"><input type="text" id="in-raid-coin"><span>ê°œ</span></div>
            </div>
            <hr class="dashed-hr">
            <div class="simple-row">
                <label style="padding-left: 10px; color:#666;">ã† ìƒê¸‰ ì´ë ¥ì „ ì½”ì¸ ì†Œëª¨ëŸ‰</label>
                <div class="input-with-unit"><input type="text" id="in-raid-coin-rare"><span>ê°œ</span></div>
            </div>
        </div>

        <div class="input-group">
            <div class="simple-row">
                <label>ëŒ€ê²°ì „ ì½”ì¸ ì†Œëª¨ëŸ‰</label>
                <div class="input-with-unit"><input type="text" id="in-grand-coin"><span>ê°œ</span></div>
            </div>
            <hr class="dashed-hr">
            <div class="simple-row">
                <label style="padding-left: 10px; color:#666;">ã† ìƒê¸‰ ëŒ€ê²°ì „ ì½”ì¸ ì†Œëª¨ëŸ‰</label>
                <div class="input-with-unit"><input type="text" id="in-grand-coin-rare"><span>ê°œ</span></div>
            </div>
        </div>

        <div class="input-group single-item-box">
            <label>ì „ìˆ  ëŒ€íšŒ ì½”ì¸ ì†Œëª¨ëŸ‰</label>
            <div class="input-with-unit">
                <input type="text" id="in-pvp-coin">
                <span style="font-size:11px;">ê°œ</span>
            </div>
        </div>

        <div class="input-group single-item-box">
            <label>ì¢…í•©ì „ìˆ ì‹œí—˜ ì½”ì¸ ì†Œëª¨ëŸ‰</label>
            <div class="input-with-unit">
                <input type="text" id="in-drill-coin">
                <span style="font-size:11px;">ê°œ</span>
            </div>
        </div>

        <div class="input-group single-item-box">
            <label>ìˆ™ë ¨ ì¦ì„œ ì†Œëª¨ëŸ‰</label>
            <div class="input-with-unit">
                <input type="text" id="in-mastery">
                <span style="font-size:11px;">ì¥</span>
            </div>
        </div>

        <div class="input-group single-item-box">
            <label>1íšŒ ëª¨ì§‘ í‹°ì¼“ ì‚¬ìš© íšŸìˆ˜</label>
            <div class="input-with-unit">
                <input type="text" id="in-ticket-1">
                <span style="font-size:11px;">íšŒ</span>
            </div>
        </div>
        <div class="input-group single-item-box">
            <label>10íšŒ ëª¨ì§‘ í‹°ì¼“ ì‚¬ìš© íšŸìˆ˜</label>
            <div class="input-with-unit">
                <input type="text" id="in-ticket-10">
                <span style="font-size:11px;">íšŒ</span>
            </div>
        </div>

		<button class="btn-preview" onclick="previewReceipt()">ğŸ‘ï¸ ì˜ìˆ˜ì¦ ë¯¸ë¦¬ë³´ê¸° (ìƒˆ ì°½)</button>
        <button class="btn-save" onclick="saveReceipt()">ğŸ’¾ ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ë¡œ ì €ì¥í•˜ê¸°</button>
		<div class="input-group" style="text-align: center; margin-top: 10px;">
            <h3 style="text-align:left;">ë°ì´í„° ë°±ì—…</h3>
            <div style="display: flex; gap: 10px;">
                <button class="btn-add-row" style="flex:1; background-color:#4a90e2; color:white; border:none;" onclick="downloadBackup()">ğŸ“¤ íŒŒì¼ë¡œ ì €ì¥</button>
                <button class="btn-add-row" style="flex:1; background-color:#e67e22; color:white; border:none;" onclick="document.getElementById('file-input').click()">ğŸ“¥ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            </div>
            <input type="file" id="file-input" style="display: none;" onchange="loadBackup(this)" accept=".json">
        </div>
        <button class="btn-reset" onclick="resetAllData()">âš ï¸ ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”</button>
    </div>

    <div class="preview-panel">
        <div class="receipt" id="capture-area">
            <div class="header-logo">
			<img src="logo_1.png" alt="4th Festival"></div>
            <div class="date-row"><span>DATE</span><span id="out-date"></span></div>
            <hr class="dashed-line">
			<div class="game-logo"><img src="logo_2.png" alt="Blue Archive"></div>
            <div class="data-box">
                <div class="data-row"><span class="label">ë‹‰ë„¤ì„</span><span class="value" id="out-nick"></span></div>
                <div class="data-row"><span class="label">ì„ ìƒë‹˜ê»˜ì„œ ì²˜ìŒ ë¶€ì„í•˜ì‹  ë‚ </span><span class="value" id="out-start"></span></div>
                <div class="data-row"><span class="label">ë¸”ì•„ì™€ í•¨ê»˜í•œ ì§€</span><span class="value" id="out-days"></span></div>
                <div class="data-row"><span class="label">ëˆ„ì  í”Œë ˆì´ ì‹œê°„</span><span class="value" id="out-playtime"></span></div>
                <div class="data-row"><span class="label">ë ˆë²¨</span><span class="value" id="out-level"></span></div>
                <div class="data-row"><span class="label">í•¨ê»˜í•œ í•™ìƒ ìˆ˜</span><span class="value" id="out-students"></span></div>
                <div class="data-row"><span class="label">í˜„ì¬ ê°€ì… ì„œí´</span><span class="value" id="out-circle"></span></div>
            </div>

            <div class="record-section">
                <div class="record-title">ë‚˜ì˜ í•™ìƒë¶€ ê¸°ë¡</div>
                <div class="record-subtitle">('ìŠ¤í‚¬ ì„±ì¥' ì •ë³´ ìˆœì„œ : EX ìŠ¤í‚¬/ê¸°ë³¸ ìŠ¤í‚¬/ê°•í™” ìŠ¤í‚¬/ì„œë¸Œ ìŠ¤í‚¬)</div>
                <div id="student-list-container"></div>
            </div>
            <div class="record-section">
                <div style="margin-bottom: 5px;">
                    <span class="record-title">ë‚˜ì˜ ìµœì•  í•™ìƒ ê¸°ë¡</span>
                    <span class="record-subtitle-inline">(í˜¸ê°ë„ ë†’ì€ ìˆœ > ì´ë¦„ ìˆœ)</span>
                </div>
                <div class="fav-list" id="fav-list-container"></div>
            </div>

            <div class="record-section">
                <div class="record-title">ë‚˜ì˜ í•™ìƒë“¤ê³¼ì˜ ìƒí™œ ê¸°ë¡</div>
                
                <div class="life-sub-header" style="margin-top: 13px;">ì´ë ¥ì „ ì—­ëŒ€ íŠ¸ë¡œí”¼</div>
                <div class="trophy-list" id="trophy-list-output"></div>

                <div class="life-sub-header">ëŒ€ê²°ì „ ì—­ëŒ€ íŠ¸ë¡œí”¼</div>
                <div class="trophy-list" id="grand-raid-list-output"></div>

                <div class="tight-list">
                    <div class="record-row"><span class="record-label-bold">ìŠ¤ì¼€ì¤„ ì§„í–‰ íšŸìˆ˜</span><span class="record-value" id="out-schedule"></span></div>
                    <div class="record-row"><span class="record-label-bold">ì„œí´ ì¶œì„ íšŸìˆ˜</span><span class="record-value" id="out-circle-attend"></span></div>
                    <div class="record-row"><span class="record-label-bold">ì œì¡° ì§„í–‰ íšŸìˆ˜</span><span class="record-value" id="out-crafting"></span></div>
                    <div class="record-row"><span class="record-label-bold">í˜„ìƒ ìˆ˜ë°° ì„ë¬´ í´ë¦¬ì–´ íšŸìˆ˜</span><span class="record-value" id="out-bounty"></span></div>
                    <div class="record-row"><span class="record-label-bold">íŠ¹ë³„ì˜ë¢° ì„ë¬´ í´ë¦¬ì–´ íšŸìˆ˜</span><span class="record-value" id="out-special"></span></div>
                    <div class="record-row"><span class="record-label-bold">í•™ì›êµë¥˜íšŒ ì„ë¬´ í´ë¦¬ì–´ íšŸìˆ˜</span><span class="record-value" id="out-school"></span></div>
                    <div class="record-row">
                        <span class="record-label-bold">ì¢…í•©ì „ìˆ ì‹œí—˜ ì„ë¬´ í´ë¦¬ì–´ íšŸìˆ˜</span>
                        <span class="record-value" id="out-drill"></span>
                    </div>
                    <div class="record-row"><span class="record-label" style="padding-left: 10px;">â€¢ ë‹¬ì„± ìµœê³  ì ìˆ˜</span><span class="record-value" id="out-drill-max"></span></div>
                    <div class="record-row"><span class="record-label" style="padding-left: 10px;">â€¢ ëˆ„ì  ì ìˆ˜</span><span class="record-value" id="out-drill-total"></span></div>
                </div>

                <div class="life-sub-header">ì œì•½í•´ì œê²°ì „ ì§„í–‰ ê¸°ë¡<span style="font-size: 8px; color: #777; margin-left: 1px;">(ì‹œì¦Œë³„ ë‹¨ê³„ í´ë¦¬ì–´ ê¸°ë¡)</span></div>
                <div class="trophy-list" id="elimination-raid-list-output"></div>

                <div class="tight-list">
                    <div class="record-row">
                        <span class="record-label-bold">ì„ë¬´(ë…¸ë©€) ì§„í–‰ íšŸìˆ˜</span>
                        <span class="record-value" id="out-mission-normal"></span>
                    </div>
                    <div class="record-row"><span class="record-label" style="padding-left: 10px;">â€¢ ì†Œíƒ• íšŸìˆ˜</span><span class="record-value" id="out-mission-normal-sweep"></span></div>
                    <div class="record-row">
                        <span class="record-label-bold">ì„ë¬´(í•˜ë“œ) ì§„í–‰ íšŸìˆ˜</span>
                        <span class="record-value" id="out-mission-hard"></span>
                    </div>
                    <div class="record-row"><span class="record-label" style="padding-left: 10px;">â€¢ ì†Œíƒ• íšŸìˆ˜</span><span class="record-value" id="out-mission-hard-sweep"></span></div>
                </div>
                
                <div id="section-main-story">
                    <div class="life-sub-header">ë©”ì¸ ìŠ¤í† ë¦¬ ì§„í–‰ë„</div>
                    <div class="tight-list" id="main-story-output-container"></div>
                </div>

                <div id="section-event-story">
                    <div class="life-sub-header">ì´ë²¤íŠ¸ ì—í”¼ì†Œë“œ ì§„í–‰ë„</div>
                    <div class="tight-list" id="event-story-output-container"></div>
                </div>
				<div id="section-mini-story">
                    <div class="life-sub-header">ë¯¸ë‹ˆ ìŠ¤í† ë¦¬ ì§„í–‰ë„</div>
                    <div class="tight-list" id="mini-story-output-container"></div>
                </div>

                <div id="section-group-story">
                    <div class="life-sub-header">ê·¸ë£¹ ìŠ¤í† ë¦¬ ì§„í–‰ë„</div>
                    <div class="tight-list" id="group-story-output-container"></div>
                </div>
				
				<div class="life-sub-header">ì—­ëŒ€ ì½œë¼ë³´ í˜¸ê°ë„ ì•„ì´í…œ</div>
                <div class="tight-list" id="collab-output-container"></div>
            </div>
			
			<div class="record-section">
				<div class="record-title">ë‚˜ì˜ ì¬í™” ê¸°ë¡</div>
                    <div class="tight-list" style="margin-top: 5px;">
                        <div class="record-row">
                            <span class="record-label">ì²­íœ˜ì„ ì†Œëª¨ëŸ‰</span>
                            <span class="record-value" id="out-pyroxene"></span>
                        </div>
                        <div class="record-row">
                            <span class="record-label">í¬ë ˆë”§ í¬ì¸íŠ¸ ì†Œëª¨ëŸ‰</span>
                            <span class="record-value" id="out-credit"></span>
                        </div>
                        <div class="record-row">
                            <span class="record-label">AP ì†Œëª¨ëŸ‰</span>
                            <span class="record-value" id="out-ap"></span>
						</div>
						<div id="record-row">
							<div class="record-label">ì„ ë¬¼ ì‚¬ìš© íšŸìˆ˜</div>
							<div class="tight-list" id="gift-sorted-output-container"></div>
						</div>
						<div class="record-row">
							<span class="record-label">ì—˜ë¦¬ê·¸ë§ˆ ì†Œëª¨ëŸ‰</span>
							<span class="record-value" id="out-eligma"></span>
						</div>
						<div class="record-row">
							<span class="record-label">ì´ë ¥ì „ ì½”ì¸ ì†Œëª¨ëŸ‰</span>
							<span class="record-value" id="out-raid-coin"></span>
						</div>
						<div class="record-row">
							<span class="record-label" style="padding-left: 10px;">â€¢ ìƒê¸‰ ì´ë ¥ì „ ì½”ì¸ ì†Œëª¨ëŸ‰</span>
							<span class="record-value" id="out-raid-coin-rare"></span>
						</div>
						<div class="record-row">
							<span class="record-label">ëŒ€ê²°ì „ ì½”ì¸ ì†Œëª¨ëŸ‰</span>
							<span class="record-value" id="out-grand-coin"></span>
						</div>
						<div class="record-row">
							<span class="record-label" style="padding-left: 10px;">â€¢ ìƒê¸‰ ëŒ€ê²°ì „ ì½”ì¸ ì†Œëª¨ëŸ‰</span>
							<span class="record-value" id="out-grand-coin-rare"></span>
						</div>
						<div class="record-row">
							<span class="record-label">ì „ìˆ  ëŒ€íšŒ ì½”ì¸ ì†Œëª¨ëŸ‰</span>
							<span class="record-value" id="out-pvp-coin"></span>
						</div>
						<div class="record-row">
							<span class="record-label">ì¢…í•©ì „ìˆ ì‹œí—˜ ì½”ì¸ ì†Œëª¨ëŸ‰</span>
							<span class="record-value" id="out-drill-coin"></span>
						</div>
						<div class="record-row">
							<span class="record-label">ìˆ™ë ¨ ì¦ì„œ ì†Œëª¨ëŸ‰</span>
							<span class="record-value" id="out-mastery"></span>
						</div>
						<div class="record-row">
							<span class="record-label">1íšŒ ëª¨ì§‘ í‹°ì¼“ ì‚¬ìš© íšŸìˆ˜</span>
							<span class="record-value" id="out-ticket-1"></span>
						</div>
						<div class="record-row">
							<span class="record-label">10íšŒ ëª¨ì§‘ í‹°ì¼“ ì‚¬ìš© íšŸìˆ˜</span>
							<span class="record-value" id="out-ticket-10"></span>
						</div>
                </div>
			</div>
			
			<hr class="dashed-line">
                
                <div class="footer-msg" style="text-align: center; font-size: 14px; line-height: 19px; margin: 20px 0;">
                    ë¸”ë£¨ ì•„ì¹´ì´ë¸Œ 4ì£¼ë…„ í–‰ì‚¬ì—<br>
                    í•¨ê»˜í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.<br>
                    ì•ìœ¼ë¡œë„ ì„ ìƒë‹˜ê³¼ í•™ìƒë“¤ì´ ê±¸ì–´ê°€ëŠ” ê¸¸ì—<br>
                    í•´í”¼ ì—”ë”©ì´ ê¸°ë‹¤ë¦´ ìˆ˜ ìˆë„ë¡<br>
                    ìš°ë¦¬ë§Œì˜ íŠ¹ë³„í•œ ì´ì•¼ê¸°ë¥¼<br>
                    ì¨ ë‚´ë ¤ê°€ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.
                </div>
                
                <div class="footer-slogan" style="text-align: center; font-size: 14px; font-weight: bold; text-decoration: underline; text-underline-offset: 1px; margin-bottom: 20px;">
						<span class="underlined-text">âœ¨ ìš°ë¦¬ë“¤ì˜ ê¸°ì ê°™ì€ ì´ì•¼ê¸°, ë¸”ë£¨ ì•„ì¹´ì´ë¸Œ âœ¨</span>
                </div>
                
                <hr class="dashed-line" style="margin-top: 35px;">
                <!--/* ë¡œê³  */-->
                <div class="footer-logo" style="text-align: center; margin-top: 20px;">
				<img src="logo_2.png" alt="Blue Archive" style="max-width: 100px;">
                </div>
        </div>
    </div>

<script>

    const defaultBasicInfo = {
        'in-date': '2025-11-29',
        'in-nick': 'ì„¹ìŠ¤',
        'in-start': '2021-11-09',
		'in-days': '0',
        'in-playtime-hour': '0',
        'in-playtime-minute': '0', 
        'in-level': '0',
        'in-students': '0',
        'in-circle': 'ì¾ì“°',
        'in-schedule': '0',
        'in-circle-attend': '0',
        'in-crafting': '0',
        'in-bounty': '0',
        'in-special': '0',
        'in-school': '0',
        'in-drill': '0',
        'in-drill-max': '0',
        'in-drill-total': '0',
        'in-mission-normal': '0',
        'in-mission-normal-sweep': '0',
        'in-mission-hard': '0',
        'in-mission-hard-sweep': '0',
		'in-pyroxene': '15578884844',
        'in-credit': '0',
        'in-ap': '0',
		'in-eligma': '0',
        'in-raid-coin': '0',
        'in-raid-coin-rare': '0',
        'in-grand-coin': '0',
        'in-grand-coin-rare': '0',
        'in-pvp-coin': '0',
        'in-drill-coin': '0',
        'in-mastery': '0',
        'in-ticket-1': '0',
        'in-ticket-10': '0'
    };
    const defaultFavText = `â˜…1ë“±â˜…. (í˜¸ê°ë„: )\nâ˜…2ë“±â˜…. (í˜¸ê°ë„: )\nâ˜…3ë“±â˜…. (í˜¸ê°ë„: )\n4ë“±. (í˜¸ê°ë„: )\n5ë“±.  (í˜¸ê°ë„: )\n6ë“±. (í˜¸ê°ë„: )\n7ë“±. (í˜¸ê°ë„: )\n8ë“±. (í˜¸ê°ë„: )\n9ë“±. (í˜¸ê°ë„: )\n10ë“±. (í˜¸ê°ë„: )`;
    const defaultStudents = [];

	const raidSeasons = [
        "ì‹œì¦Œ 1 - ì‹œë¡œ & ì¿ ë¡œ (ì‹œê°€ì „)", 
        "ì‹œì¦Œ 2 - í—¤ì„¸ë“œ (ì•¼ì „)", 
        "ì‹œì¦Œ 3 - ì‹œë¡œ & ì¿ ë¡œ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 4 - í—¤ì„¸ë“œ (ì•¼ì „)", 
        "ì‹œì¦Œ 5 - ì˜ˆë¡œë‹ˆë¬´ìŠ¤ (ì‹¤ë‚´ì „)",
        "ì‹œì¦Œ 6 - ë¹„ë‚˜ (ì•¼ì „)", 
        "ì‹œì¦Œ 7 - ì‹œë¡œ & ì¿ ë¡œ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 8 - í—¤ì„¸ë“œ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 9 - KAITEN FX Mk.0 (ì•¼ì „)", 
        "ì‹œì¦Œ 10 - ì‹œë¡œ & ì¿ ë¡œ (ì‹œê°€ì „)",
        "ì‹œì¦Œ 11 - ì˜ˆë¡œë‹ˆë¬´ìŠ¤ (ì‹œê°€ì „)", 
        "ì‹œì¦Œ 12 - KAITEN FX Mk.0 (ì•¼ì „)", 
        "ì‹œì¦Œ 13 - ë¹„ë‚˜ (ì‹œê°€ì „)", 
        "ì‹œì¦Œ 14 - í˜ë¡œë¡œì§€ë¼ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 15 - KAITEN FX Mk.0 (ì‹œ...",
        "ì‹œì¦Œ 16 - ë¹„ë‚˜ (ì•¼ì „)", 
        "ì‹œì¦Œ 17 - í˜ë¡œë¡œì§€ë¼ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 18 - ì˜ˆë¡œë‹ˆë¬´ìŠ¤ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 19 - í—¤ì„¸ë“œ (ì•¼ì „)", 
        "ì‹œì¦Œ 20 - í˜ë¡œë¡œì§€ë¼ (ì•¼ì „)",
        "ì‹œì¦Œ 21 - í˜¸ë“œ (ì‹œê°€ì „)", 
        "ì‹œì¦Œ 22 - ì‹œë¡œ & ì¿ ë¡œ (ì‹œê°€ì „)", 
        "ì‹œì¦Œ 23 - KAITEN FX Mk.0 (ì•¼ì „)", 
        "ì‹œì¦Œ 24 - ë¹„ë‚˜ (ì‹œê°€ì „)", 
        "ì‹œì¦Œ 25 - í˜¸ë“œ (ì‹œê°€ì „)",
        "ì‹œì¦Œ 26 - í—¤ì„¸ë“œ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 27 - í˜ë¡œë¡œì§€ë¼ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 28 - KAITEN FX Mk.0 (ì‹œ...", 
        "ì‹œì¦Œ 29 - ì˜ˆë¡œë‹ˆë¬´ìŠ¤ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 30 - ë¹„ë‚˜ (ì•¼ì „)",
        "ì‹œì¦Œ 31 - í—¤ì„¸ë“œ (ì•¼ì „)", 
        "ì‹œì¦Œ 32 - ì‹œë¡œ & ì¿ ë¡œ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 33 - í˜¸ë“œ (ì‹œê°€ì „)", 
        "ì‹œì¦Œ 34 - ì˜ˆë¡œë‹ˆë¬´ìŠ¤ (ì‹œê°€ì „)", 
        "ì‹œì¦Œ 35 - KAITEN FX Mk.0 (ì•¼ì „)",
        "ì‹œì¦Œ 36 - í˜ë¡œë¡œì§€ë¼ (ì•¼ì „)", 
        "ì‹œì¦Œ 37 - ê³ ì¦ˆ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 38 - ì‹œë¡œ & ì¿ ë¡œ (ì‹œê°€ì „)", 
        "ì‹œì¦Œ 39 - ë¹„ë‚˜ (ì‹œê°€ì „)", 
        "ì‹œì¦Œ 40 - í—¤ì„¸ë“œ (ì‹¤ë‚´ì „)",
        "ì‹œì¦Œ 41 - í˜ë¡œë¡œì§€ë¼ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 42 - ì˜ˆë¡œë‹ˆë¬´ìŠ¤ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 43 - ì‹œë¡œ & ì¿ ë¡œ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 44 - ì˜ˆë¡œë‹ˆë¬´ìŠ¤ (ì‹œê°€ì „)", 
        "ì‹œì¦Œ 45 - ë¹„ë‚˜ (ì•¼ì „)",
        "ì‹œì¦Œ 46 - ê³ ì¦ˆ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 47 - í—¤ì„¸ë“œ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 48 - ì‹œë¡œ & ì¿ ë¡œ (ì‹œê°€ì „)", 
        "ì‹œì¦Œ 49 - KAITEN FX Mk.0 (ì•¼ì „)", 
        "ì‹œì¦Œ 50 - í˜ë¡œë¡œì§€ë¼ (ì•¼ì „)",
        "ì‹œì¦Œ 51 - í˜¸ë“œ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 52 - ê·¸ë ˆê³ ë¦¬ì˜¤ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 53 - ê³ ì¦ˆ (ì•¼ì „)", 
        "ì‹œì¦Œ 54 - í˜¸ë²„í¬ë˜í”„íŠ¸ (ì•¼ì „)", 
        "ì‹œì¦Œ 55 - ë¹„ë‚˜ (ì‹œê°€ì „)",
        "ì‹œì¦Œ 56 - í—¤ì„¸ë“œ (ì•¼ì „)", 
        "ì‹œì¦Œ 57 - ë¬˜ê·€ ì¿ ë¡œì¹´ê²Œ (ì‹œê°€ì „)", 
        "ì‹œì¦Œ 58 - í˜¸ë²„í¬ë˜í”„íŠ¸ (ì•¼ì „)", 
        "ì‹œì¦Œ 59 - ì˜ˆë¡œë‹ˆë¬´ìŠ¤ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 60 - í—¤ì„¸ë“œ (ì‹¤ë‚´ì „)",
        "ì‹œì¦Œ 61 - í˜ë¡œë¡œì§€ë¼ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 62 - í˜¸ë“œ (ì‹œê°€ì „)", 
        "ì‹œì¦Œ 63 - ê³ ì¦ˆ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 64 - ë¹„ë‚˜ (ì•¼ì „)", 
        "ì‹œì¦Œ 65 - í˜ë¡œë¡œì§€ë¼ (ì•¼ì „)",
        "ì‹œì¦Œ 66 - ì‹œë¡œ & ì¿ ë¡œ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 67 - KAITEN FX Mk.0 (ì‹œ...", 
        "ì‹œì¦Œ 68 - ê·¸ë ˆê³ ë¦¬ì˜¤ (ì‹¤ë‚´ì „)", 
        "ì‹œì¦Œ 69 - ì˜ˆë¡œë‹ˆë¬´ìŠ¤ (ì‹œê°€ì „)", 
        "ì‹œì¦Œ 70 - í˜¸ë²„í¬ë˜í”„íŠ¸ (ì•¼ì „)",
        "ì‹œì¦Œ 71 - ê²Œë¶€ë¼ (ì•¼ì „)", 
        "ì‹œì¦Œ 72 - ë¬˜ê·€ ì¿ ë¡œì¹´ê²Œ (ì‹œê°€ì „)", 
        "ì‹œì¦Œ 73 - í˜¸ë²„í¬ë˜í”„íŠ¸ (ì•¼ì „)", 
        "ì‹œì¦Œ 74 - ê·¸ë ˆê³ ë¦¬ì˜¤ (ì‹¤ë‚´ì „)"
    ];

    const grandRaidSeasons = [
        "ì‹œì¦Œ 1 - í˜ë¡œë¡œì§€ë¼ (ì•¼ì „)", 
		"ì‹œì¦Œ 2 - ì‹œë¡œ & ì¿ ë¡œ (ì‹¤ë‚´ì „)", 
		"ì‹œì¦Œ 3 - KAITEN FX Mk.0 (...",
        "ì‹œì¦Œ 4 - í˜¸ë“œ (ì‹œê°€ì „)", 
		"ì‹œì¦Œ 5 - ê³ ì¦ˆ (ì•¼ì „)", 
		"ì‹œì¦Œ 6 - ì‹œë¡œ & ì¿ ë¡œ (ì‹œê°€ì „)",
        "ì‹œì¦Œ 7 - KAITEN FX Mk.0 (...", 
		"ì‹œì¦Œ 8 - ë¹„ë‚˜ (ì‹œê°€ì „)", 
		"ì‹œì¦Œ 9 - ê·¸ë ˆê³ ë¦¬ì˜¤ (ì‹¤ë‚´ì „)",
        "ì‹œì¦Œ 10 - ì˜ˆë¡œë‹ˆë¬´ìŠ¤ (ì‹œê°€ì „)", 
		"ì‹œì¦Œ 11 - í˜¸ë²„í¬ë˜í”„íŠ¸ (ì•¼ì „)", 
		"ì‹œì¦Œ 12 - ì‹œë¡œ & ì¿ ë¡œ (ì‹¤ë‚´ì „)",
        "ì‹œì¦Œ 13 - ê³ ì¦ˆ (ì•¼ì „)", 
		"ì‹œì¦Œ 14 - í˜ë¡œë¡œì§€ë¼ (ì•¼ì „)", 
		"ì‹œì¦Œ 15 - ë¬˜ê·€ ì¿ ë¡œì¹´ê²Œ (ì‹œê°€ì „)",
        "ì‹œì¦Œ 16 - í—¤ì„¸ë“œ (ì•¼ì „)", 
		"ì‹œì¦Œ 17 - ë¹„ë‚˜ (ì‹œê°€ì „)", 
		"ì‹œì¦Œ 18 - KAITEN FX Mk.0 (...",
        "ì‹œì¦Œ 19 - ê·¸ë ˆê³ ë¦¬ì˜¤ (ì‹¤ë‚´ì „)", 
		"ì‹œì¦Œ 20 - ë¹„ë‚˜ (ì•¼ì „)", 
		"ì‹œì¦Œ 21 - í—¤ì„¸ë“œ (ì‹¤ë‚´ì „)",
        "ì‹œì¦Œ 22 - ì‹œë¡œ & ì¿ ë¡œ (ì‹¤ë‚´ì „)"
    ];

    const eliminationRaidSeasons = [
        "ì‹œì¦Œ 1 - ì„¸íŠ¸ì˜ ë¶„ë…¸ (íŠ¹ìˆ˜ì¥ê°‘)", "ì‹œì¦Œ 2 - ì„¸íŠ¸ì˜ ë¶„ë…¸ (ê²½ì¥ê°‘)", "ì‹œì¦Œ 3 - ì„¸íŠ¸ì˜ ë¶„ë…¸ (íŠ¹ìˆ˜ì¥ê°‘)",
        "ì‹œì¦Œ 4 - ì„¸íŠ¸ì˜ ë¶„ë…¸ (ê²½ì¥ê°‘)", "ì‹œì¦Œ 5 - ì„¸íŠ¸ì˜ ë¶„ë…¸ (íŠ¹ìˆ˜ì¥ê°‘)", "ì‹œì¦Œ 6 - ì„¸íŠ¸ì˜ ë¶„ë…¸ (ê²½ì¥ê°‘)",
        "ì‹œì¦Œ 7 - ì„¸íŠ¸ì˜ ë¶„ë…¸ (íŠ¹ìˆ˜ì¥ê°‘)", "ì‹œì¦Œ 8 - í˜¸í¬ë§ˆ (íŠ¹ìˆ˜ì¥ê°‘)", "ì‹œì¦Œ 9 - ì„¸íŠ¸ì˜ ë¶„ë…¸ (ê²½ì¥ê°‘)",
        "ì‹œì¦Œ 10 - í˜¸í¬ë§ˆ (ì¤‘ì¥ê°‘)", "ì‹œì¦Œ 11 - ì„¸íŠ¸ì˜ ë¶„ë…¸ (íŠ¹ìˆ˜ì¥ê°‘)", "ì‹œì¦Œ 12 - í˜¸í¬ë§ˆ",
        "ì‹œì¦Œ 13 - ì„¸íŠ¸ì˜ ë¶„ë…¸ (ê²½ì¥ê°‘)", "ì‹œì¦Œ 14 - í‹°í˜ë ˆíŠ¸ (íƒ„ë ¥ì¥ê°‘)", "ì‹œì¦Œ 15 - í˜¸í¬ë§ˆ (ì¤‘ì¥ê°‘)"
    ];

    const mainStoryList = [
        { key: 'ms_1', name: '1. ëŒ€ì±…ìœ„ì›íšŒ í¸' },
        { key: 'ms_2', name: '2. íƒœì—½ ê°ëŠ” ê½ƒì˜ íŒŒë°˜ëŠ í¸' },
        { key: 'ms_3', name: '3. ì—ë´ì¡°ì•½ í¸' },
        { key: 'ms_4', name: '4. ì¹´ë¥´ë°”ë…¸ê·¸ì˜ í† ë¼ í¸' },
        { key: 'ms_5', name: '5. ë°±í™”ìš”ë€ í¸' },
        { key: 'ms_6', name: 'Final. ê·¸ë¦¬ê³  ëª¨ë“  ê¸°ì ì´ ì‹œì‘ ë˜...' }
    ];

    const eventStoryList = [
		{ key: 'es_1', name: 'ë²šê½ƒë§Œë°œ ì¶•ì œëŒ€ì†Œë™!' },
        { key: 'es_2', name: 'í˜ëª…ì˜ ì´ë°˜ ì¿ íŒ”ë¼' },
        { key: 'es_3', name: 'ì—¬ë¦„ í•˜ëŠ˜ì˜ ìœ„ì‹œë¦¬ìŠ¤íŠ¸' },
        { key: 'es_4', name: 'íˆë‚˜ ì„ ë„ë¶€ì¥ë‹˜ì˜ ì—¬ë¦„ë°©í•™!' },
        { key: 'es_5', name: 'ë„¤ë²„ëœë“œì—ì„œì˜ ìˆ ë˜ì¡ê¸°' },
        { key: 'es_6', name: 'ì„ ìƒì˜ ë°”ë‹ˆ ì²´ì´ì„œ' },
        { key: 'es_7', name: '227í˜¸ ì˜¨ì²œì¥ ìš´ì˜ì¼ì§€!' },
        { key: 'es_8', name: 'ì‹ ì¶˜ê´‘ìƒê³¡ ì œ68ë²ˆ' },
        { key: 'es_9', name: 'ìƒ¬ë ˆì˜ í•´í”¼â™¡ë°œë Œíƒ€ì¸ ìˆœì°°' },
        { key: 'es_10', name: 'ì½”ì‚¬ì¹´ ì™€ì¹´ëª¨ì˜ ì¹¨ë¬µê³¼ ì¶•ì—°' },
        { key: 'es_11', name: 'ëœë ëŒ€ëŠ” ìˆ˜ë…€ë‹˜ê³¼ ê³ ì„œê´€ì˜ ë§ˆìˆ ì‚¬' },
        { key: 'es_12', name: 'ë¶ˆì¸ì˜ ë§ˆìŒ' },
        { key: 'es_13', name: 'ì•„ë¹„ë„ìŠ¤ ë¦¬ì¡°íŠ¸ ë³µêµ¬ ëŒ€ì±…ìœ„ì›íšŒ' },
        { key: 'es_14', name: 'ì¶œì¥! ë°±ì•¼ë‹¹ ë°”ë‹¤ì˜ ì§‘ í”„ëœì°¨ì´ì¦ˆ ê³„íš' },
        { key: 'es_15', name: 'ë°©ê³¼ í›„ ë””ì €íŠ¸ ì´ì•¼ê¸°' },
        { key: 'es_16', name: 'ON YOUR MARK @ MILLENNIUM' },
        { key: 'es_17', name: 'Get Set, Go!' },
        { key: 'es_18', name: 'ì„±ë‹¹ì˜ ë©”ë¦¬ í¬ë¦¬ìŠ¤ë§ˆìŠ¤' },
        { key: 'es_19', name: 'ìƒˆí•´ì˜ ì•„í˜ë¦¬í‹°í”„' },
        { key: 'es_20', name: 'ê±°ì§“ëœ ì„±ì†Œ ê³µëµì „' },
        { key: 'es_21', name: 'ì•„íŠ¸ë¼í•˜ì‹œìŠ¤ì˜ ë°©ì£¼ ì ë ¹ì „' },
        { key: 'es_22', name: 'í”„ë ˆë‚˜íŒŒí…ŒìŠ¤ ê²°ì „' },
        { key: 'es_23', name: 'ë³µêµ¬ ì‘ì—…: D.U. ì‹œë¼í† ë¦¬êµ¬' },
        { key: 'es_24', name: 'ìˆœë°±ì˜ ì˜ˆê³ ì¥' },
        { key: 'es_25', name: 'ìš©ë¬´ë™ì£¼' },
        { key: 'es_26', name: 'ì‚¬ë¼ì§„ ìƒˆìš°ë¥¼ í–¥í•œ í† ë¼ì˜ ì¶”ì ' },
        { key: 'es_27', name: 'ìˆ¨ê²¨ì§„ ìœ ì‚°ì„ ì°¾ì•„ì„œ' },
        { key: 'es_28', name: 'í•™ì› ë™ì¸ ì´ì•¼ê¸°' },
        { key: 'es_29', name: 'Trip-Trap-Train' },
        { key: 'es_30', name: 'ì „ë‡Œì‹ ì¶˜í–‰ì§„ê³¡' },
        { key: 'es_31', name: 'ë¹›ìœ¼ë¡œ ë‚˜ì•„ê°€ëŠ” ê·¸ë…€ë“¤ì˜ ì†Œì•¼ê³¡' },
        { key: 'es_32', name: '0068 ì˜¤í˜ë¼ë¡œë¶€í„° ì‚¬ë‘ì„ ë‹´ì•„ì„œ!' },
        { key: 'es_33', name: 'ì™€ê¸€ì™€ê¸€í•˜ë©° ì˜¤ì†ë„ì†í•˜ê²Œ' },
        { key: 'es_34', name: '-ive aLIVE!' },
        { key: 'es_35', name: 'Say-Bing!' },
        { key: 'es_36', name: 'Sheside outside' },
        { key: 'es_37', name: 'ì›”í™”ëª½ì†Œ' },
        { key: 'es_38', name: 'ì˜¤ìš•ë‚´ê°•' },
        { key: 'es_39', name: 'Serenade Promenade' },
        { key: 'es_40', name: 'ë¹„ë°€ì˜ ë¯¸ë“œë‚˜ì‡ íŒŒí‹° ~ì¢…ì´ ìš¸ë¦¬ëŠ” ìˆ ...' },
        { key: 'es_41', name: 'Code: BOX ë°€ë ˆë‹ˆì—„ì— ë‹¤ê°€ì˜¤ëŠ” ê·¸...' },
        { key: 'es_42', name: 'íŒ¬ë°ë¯¹ í•´ì €ë“œ ~ ê¸°ì ì˜ íŒ¬ì¼€ì´í¬ ~' },
        { key: 'es_43', name: 'Pray-Ball! ~ ë…¸ë ¤ë¼! ë§Œë£¨ í™ˆëŸ° ~' },
        { key: 'es_44', name: 'í•˜ì´ëœë” ì² ë„ í­ì£¼ ì‚¬ê±´ ~ ê·¸ë¦¬ê³  ê¸°...' }
    ];
	
	const miniStoryList = [
        { key: 'mn_1', name: 'ë§Œë§ˆì „ì˜ ë¶‰ì€ê²¨ìš¸ ìˆœíšŒë¡', defEp: 2 },
        { key: 'mn_2', name: 'í…ŒíŠ¸ë§ˆì´ ì•„ì¹´ì´', defEp: 3 },
        { key: 'mn_3', name: 'í‚¤ë¼ë¼ì™€ ì—ë¦¬ì¹´ì˜ ë°˜ì§ë°˜ì§í•œ í•˜ë£¨', defEp: 2 },
        { key: 'mn_4', name: 'í•˜ì´ëœë” ìš´í–‰ ì¼ì§€', defEp: 2 },
        { key: 'mn_5', name: 'ì£¼ì¸ ìƒì€ ì„ ë¬¼', defEp: 3 },
        { key: 'mn_6', name: 'ì–´ëŠ 2ì›” 19ì¼ì˜ ê¸°ë¡', defEp: 3 },
        { key: 'mn_7', name: 'ë¯¸ì‹ê³¼ ì¿ í‚¤. ê·¸ë¦¬ê³  êµ¬í˜¸', defEp: 2 },
        { key: 'mn_8', name: 'ì–´ì©Œë‹¤ ë§ˆì£¼ì¹œ ê·¸ëŒ€', defEp: 2 }
    ];

    const groupStoryList = [
        { key: 'gr_1', name: 'ë¯¸ì‹ì—°êµ¬íšŒ', defEp: 4 },
        { key: 'gr_2', name: 'Cleaning&Clearing', defEp: 3 },
        { key: 'gr_3', name: 'í¥ì‹ ì†Œ 68', defEp: 1 },
        { key: 'gr_4', name: 'ì—”ì§€ë‹ˆì–´ë¶€', defEp: 3 },
        { key: 'gr_5', name: 'ë² ë¦¬íƒ€ìŠ¤', defEp: 3 },
        { key: 'gr_6', name: 'ê¸‰ì–‘ë¶€', defEp: 2 },
        { key: 'gr_7', name: 'êµ¬í˜¸ê¸°ì‚¬ë‹¨', defEp: 3 },
        { key: 'gr_8', name: 'ì •ì˜ì‹¤í˜„ë¶€', defEp: 2 },
        { key: 'gr_9', name: 'ì„ ë„ë¶€', defEp: 2 },
        { key: 'gr_10', name: 'ë°©ê³¼í›„ ë””ì €íŠ¸ë¶€', defEp: 2 },
        { key: 'gr_11', name: 'ëŒ€ì±…ìœ„ì›íšŒ', defEp: 2 },
        { key: 'gr_12', name: 'ë¶‰ì€ê²¨ìš¸ ì‚¬ë¬´êµ­', defEp: 3 },
        { key: 'gr_13', name: 'ë§ˆì¸ ë¦¬ìš´ì˜ê´€ë¦¬ë¶€', defEp: 2 },
        { key: 'gr_14', name: 'ìˆ˜í–‰ë¶€', defEp: 4 },
        { key: 'gr_15', name: 'ê²Œì„ê°œë°œë¶€', defEp: 2 },
        { key: 'gr_16', name: 'ë§¤í™”ì›', defEp: 2 },
        { key: 'gr_17', name: 'ìƒí™œì•ˆì „êµ­', defEp: 2 },
        { key: 'gr_18', name: '227í˜¸ íŠ¹ë³„ë°˜', defEp: 2 },
        { key: 'gr_19', name: 'ì¸ë²•ì—°êµ¬ë¶€', defEp: 2 },
        { key: 'gr_20', name: 'RABBIT ì†ŒëŒ€', defEp: 3 },
        { key: 'gr_21', name: 'ì„¸ë¯¸ë‚˜', defEp: 3 },
        { key: 'gr_22', name: 'ìŒì–‘ë¶€', defEp: 2 },
        { key: 'gr_23', name: 'íŠ¸ë ˆì´ë‹ë¶€', defEp: 3 },
        { key: 'gr_24', name: 'í˜„ë£¡ë¬¸', defEp: 3 },
        { key: 'gr_25', name: 'ì˜¨ì²œê°œë°œë¶€', defEp: 2 }
    ];
	
	const collabOptionsList = [
		"ë§˜ìŠ¤í„°ì¹˜ ê¸°ë… ì¹´ë“œ", "ë§˜ìŠ¤í„°ì¹˜ ê¸°ë… ì„¸íŠ¸", "ë¬´ì‹ ì‚¬ ê¸°ë… ì¹´ë“œ", "ì˜¤ì¼€ìŠ¤íŠ¸ë¼ ê¸°ë… í‹°ì¼“", "ì´ë””ì•¼ì»¤í”¼ ê¸°ë… í‹°ì¼“",
		"íŒŒíŒŒì¡´ìŠ¤ ê¸°ë… ì¹´ë“œ", "í”„ë­í¬ ë²„ê±° ê¸°ë… ì¹´ë“œ", "ëŒ€í•œì ì‹­ìì‚¬ ê¸°ë… ì¹´ë“œ",	"ë„¥ìŠ¨ 30ì£¼ë…„ ê¸°ë… ì¹´ë“œ", "ë‹¬ì½¤ì»¤í”¼ ê¸°ë… ì¹´ë“œ",
		"ì‚¬ìš´ë“œ ì•„ì¹´ì´ë¸Œ ê¸°ë… í‹°ì¼“", "í˜„ëŒ€ë°±í™”ì  PEER ê¸°ë… ì¹´ë“œ", "GS25 ê¸°ë… ë„ì‹œë½", "GS25 ê¸°ë… ì¹´ë“œ","í•˜ì¸ ë„¤ ë¯¸ì¿ ì˜ í¬í†  ì¹´ë“œ"
    ];
	
    const giftOptionsList = [
		"ì›¨ì´ë¸Œìº£ ë² ê°œ", "í˜ë¡œë¡œ íœ  ìŠ¬ë¼ì´ë“œ", "ì—ì´~íŒŸ í”„ë¡œ", "ê¸ˆë‹¨ì˜ ì—°ì•  ~í—ˆë½ë˜ì§€ ì•Šì•„ì„œ, ë”ìš± ì•„...", "ê²Œì„ ì¡ì§€ ã€íˆíŠ¸ê±¸ì¦ˆã€",
        "ì²´ë¦¬ë¡œì¦ˆ ë¦½ê¸€ë¡œì¦ˆ", "í”¼ë¶€ê¹Œì§€ íˆ¬ëª…í•´ì§€ëŠ” BBí¬ë¦¼", "ë°€ë¦¬í„°ë¦¬ 3ì¢… ìœ„ì¥ìš© íŒŒìš´ë°ì´ì…˜", "ê³ ê¸‰ ì¿ í‚¤ ì„¸íŠ¸", "<ì´, ê·€ì—¬ì›€, ì²­ì¶˜>",
		"ì²œì²´ë§ì›ê²½", "ê²Œì„ê±¸ ì»¬ëŸ¬ ë³µê°íŒ", "MX-ë ˆì´ì…˜ Cí˜• ë””ì €íŠ¸ ë§›", "ë§ì°¨ë§› ë¼ë¬´ë„¤", "ì ¤ë¦¬ì¦ˆ ì¿ ì…˜", 
        "ì´ˆì ˆ í† ë¼ íƒì • ~ì•ˆê°œë¡œ ê°€ë ¤ì§„ ì˜¨ì²œ ë¯¸...", "O-ì˜¤í”¼íŠ¸", "ë§¤ì¥ê¸ˆì˜ ì§€ë„", "ì½”ìŠ¤í”„ë ˆìš© ë±…ë±…ì´ ì•ˆê²½",
		"ì„¸ìƒì—ì„œ ê°€ì¥ ì“¸ë°ì—†ëŠ” ê¸°ê³„", "ë¦¬ë³¸ì´ ë‹¬ë¦° ê³°ì¸í˜•", "ì˜í™” ì˜ˆë§¤ê¶Œ", "30ìƒ‰ ë¬¼ê° ì„¸íŠ¸", "ê³ ì „ ì‹œì§‘", "ê·€ì—¬ìš´ ê·¸ë¦‡ ì„¸íŠ¸",
        "ë‘ë‡Œê°œë°œìš© í¼ì¦ íë¸Œ", "ëŒ€í˜• í™€ ì¼€ì´í¬", "ê³ ê¸‰ ë·”í˜ ì´ˆëŒ€ê¶Œ", "ì‹ì¶©ì‹ë¬¼ í™”ë¶„", "ë¹„ì‹¸ë³´ì´ëŠ” ê¸ˆë°• ìš•ë§ì˜ í•­ì•„ë¦¬", "íƒœì—½ì¥ì¹˜ ì˜¤ë¥´ê³¨", "ììˆ˜ê°€ ë†“ì¸ ì†ìˆ˜ê±´", "ë°±ê³¼ì‚¬ì „",
        "ê±´ê°•ë³´ì¡°ì‹í’ˆ", "ì—¬ë¦„ìš© íŠœë¸Œ", "ë ˆì´ìŠ¤ ë² ê°œ", "ìŠ¤íŠ¸ë¦¬íŠ¸ ì˜¤ë¸Œ ë¶ˆëŸ‰ë°° 1ê¶Œ", "ì‚¬ë¬´ì—˜ë¼ <ë” ë¹„ìš˜ë“œ>", "ê³ í’ìŠ¤ëŸ¬ìš´ ë‹¬ê±€ ê³µì˜ˆí’ˆ", "ë°€í”¼ìœ ì˜ ì •í†µ íŒŒë¥´í˜",
        "ì—ì´~ë¶ ë ˆì–´", "ì„¸ë ¨ëœ ë¨¸ë¦¬ë¹—", "ì˜ì–‘ê°€ë“ ì¢…í•© ë¹„íƒ€ë¯¼ ì ¤ë¦¬", "ìµœê³ ê¸‰ ë‹¨í’ë‚˜ë¬´ ë¶„ì¬", "ë°˜ì§‡ê³ ë¦¬ í‚¤íŠ¸", "ìŒì•… ì—°ì£¼íšŒ ì…ì¥ê¶Œ", "í•˜ë£¨ ì„¸ ë²ˆ ë¤ë²¨ ì„¸íŠ¸", "ë³´ë“œ ê²Œì„ <ë” ì¸ìƒ>",
		"ì•„ë¦„ë‹¤ìš´ ê½ƒë‹¤ë°œ","ë°˜ì§ì´ëŠ” ê½ƒë‹¤ë°œ","ì‹±ê·¸ëŸ¬ìš´ ê½ƒë‹¤ë°œ","í•˜ì¸ ë„¤ ë¯¸ì¿ ì˜ í¬í†  ì¹´ë“œ",
		"ë§˜ìŠ¤í„°ì¹˜ ê¸°ë… ì¹´ë“œ", "ë§˜ìŠ¤í„°ì¹˜ ê¸°ë… ì„¸íŠ¸", "ë¬´ì‹ ì‚¬ ê¸°ë… ì¹´ë“œ", "ì˜¤ì¼€ìŠ¤íŠ¸ë¼ ê¸°ë… í‹°ì¼“", "ì´ë””ì•¼ì»¤í”¼ ê¸°ë… í‹°ì¼“",
		"íŒŒíŒŒì¡´ìŠ¤ ê¸°ë… ì¹´ë“œ", "í”„ë­í¬ ë²„ê±° ê¸°ë… ì¹´ë“œ", "ëŒ€í•œì ì‹­ìì‚¬ ê¸°ë… ì¹´ë“œ",	"ë„¥ìŠ¨ 30ì£¼ë…„ ê¸°ë… ì¹´ë“œ", "ë‹¬ì½¤ì»¤í”¼ ê¸°ë… ì¹´ë“œ",
		"ì‚¬ìš´ë“œ ì•„ì¹´ì´ë¸Œ ê¸°ë… í‹°ì¼“", "í˜„ëŒ€ë°±í™”ì  PEER ê¸°ë… ì¹´ë“œ", "GS25 ê¸°ë… ë„ì‹œë½", "GS25 ê¸°ë… ì¹´ë“œ"
    ];

    let studentData = JSON.parse(localStorage.getItem('ba_receipt_students')) || defaultStudents;
    let savedBasicInfo = JSON.parse(localStorage.getItem('ba_receipt_basic')) || defaultBasicInfo;
    let savedFavText = localStorage.getItem('ba_receipt_fav') || defaultFavText;
    let savedRaidData = JSON.parse(localStorage.getItem('ba_receipt_raid')) || {}; 
    let savedGrandRaidData = JSON.parse(localStorage.getItem('ba_receipt_grand_raid')) || {};
    let savedEliminationRaidData = JSON.parse(localStorage.getItem('ba_receipt_elim_raid')) || {};
    let savedMainStory = JSON.parse(localStorage.getItem('ba_receipt_main_story')) || {};
    let savedEventStory = JSON.parse(localStorage.getItem('ba_receipt_event_story')) || {};
	let savedMiniStory = JSON.parse(localStorage.getItem('ba_receipt_mini_story')) || {};
    let savedGroupStory = JSON.parse(localStorage.getItem('ba_receipt_group_story')) || {};


    let editingIndex = -1;

	const mappings = [
        { in: 'in-date', out: 'out-date' }, { in: 'in-nick', out: 'out-nick' }, { in: 'in-start', out: 'out-start' },
        { in: 'in-days', out: 'out-days' }, { in: 'in-level', out: 'out-level' }, { in: 'in-students', out: 'out-students' },
        { in: 'in-circle', out: 'out-circle' }, { in: 'in-schedule', out: 'out-schedule' }, { in: 'in-circle-attend', out: 'out-circle-attend' },
        { in: 'in-crafting', out: 'out-crafting' }, { in: 'in-bounty', out: 'out-bounty' }, { in: 'in-special', out: 'out-special' },
        { in: 'in-school', out: 'out-school' }, { in: 'in-drill', out: 'out-drill' }, { in: 'in-drill-max', out: 'out-drill-max' },
        { in: 'in-drill-total', out: 'out-drill-total' }, { in: 'in-mission-normal', out: 'out-mission-normal' },
        { in: 'in-mission-normal-sweep', out: 'out-mission-normal-sweep' }, { in: 'in-mission-hard', out: 'out-mission-hard' },
        { in: 'in-mission-hard-sweep', out: 'out-mission-hard-sweep' }, { in: 'in-pyroxene', out: 'out-pyroxene' },
        { in: 'in-credit', out: 'out-credit' }, { in: 'in-ap', out: 'out-ap' }, { in: 'in-eligma', out: 'out-eligma' },
        { in: 'in-raid-coin', out: 'out-raid-coin' }, { in: 'in-raid-coin-rare', out: 'out-raid-coin-rare' },
        { in: 'in-grand-coin', out: 'out-grand-coin' }, { in: 'in-grand-coin-rare', out: 'out-grand-coin-rare' },
        { in: 'in-pvp-coin', out: 'out-pvp-coin' }, { in: 'in-drill-coin', out: 'out-drill-coin' }, { in: 'in-mastery', out: 'out-mastery' },
        { in: 'in-ticket-1', out: 'out-ticket-1' }, { in: 'in-ticket-10', out: 'out-ticket-10' }
    ];
	
	const hourInput = document.getElementById('in-playtime-hour');
    const minInput = document.getElementById('in-playtime-minute');
    const playTimeOutput = document.getElementById('out-playtime');
	
	function updatePlayTime() {

        const hRaw = hourInput.value.replace(/[^0-9]/g, '');
        const mRaw = minInput.value.replace(/[^0-9]/g, '');

        if(hRaw) hourInput.value = Number(hRaw).toLocaleString();
        if(mRaw) minInput.value = Number(mRaw).toLocaleString();

        const h = hourInput.value;
        const m = minInput.value;
        
        savedBasicInfo['in-playtime-hour'] = h;
        savedBasicInfo['in-playtime-minute'] = m;
        localStorage.setItem('ba_receipt_basic', JSON.stringify(savedBasicInfo));
        
        const hFmt = h.replace(/[^0-9]/g, '');
        const mFmt = m.replace(/[^0-9]/g, '');
        if(playTimeOutput) playTimeOutput.textContent = `${hFmt ? Number(hFmt).toLocaleString() : '0'}ì‹œê°„ ${mFmt}ë¶„`;
    }

    if(hourInput && minInput) {
        hourInput.value = savedBasicInfo['in-playtime-hour'] || '';
        minInput.value = savedBasicInfo['in-playtime-minute'] || '';
        updatePlayTime();
        hourInput.addEventListener('input', updatePlayTime);
        minInput.addEventListener('input', updatePlayTime);
    }

	const textFields = ['in-date', 'in-nick', 'in-start', 'in-circle'];

    const countFields = ['in-schedule', 'in-circle-attend', 'in-crafting', 'in-bounty', 'in-special', 'in-school', 'in-drill', 'in-mission-normal', 'in-mission-normal-sweep', 'in-mission-hard', 'in-mission-hard-sweep', 'in-ticket-1', 'in-ticket-10'];
    const scoreFields = ['in-drill-max', 'in-drill-total'];
    const unitFields = ['in-raid-coin', 'in-raid-coin-rare', 'in-grand-coin', 'in-grand-coin-rare', 'in-pvp-coin', 'in-drill-coin', 'in-pyroxene', 'in-eligma'];

	mappings.forEach(map => {
        const input = document.getElementById(map.in);
        const output = document.getElementById(map.out);
        
        if(input && output) {
            let val = savedBasicInfo[map.in] || '';
            
            if (!textFields.includes(map.in)) {
                const num = val.toString().replace(/[^0-9]/g, '');
                if(num) val = Number(num).toLocaleString();
            }
            
            input.value = val;
            updateOutput(map.in, val, output);

            input.addEventListener('input', () => { 
                if (!textFields.includes(map.in)) {
                    const raw = input.value.replace(/[^0-9]/g, '');
                    if(raw) {
                        input.value = Number(raw).toLocaleString();
                    }
                }
                
                savedBasicInfo[map.in] = input.value;
                localStorage.setItem('ba_receipt_basic', JSON.stringify(savedBasicInfo));
                updateOutput(map.in, input.value, output);
            });
        }
    });

		function updateOutput(id, value, outputElement) {
			const num = value.replace(/[^0-9]/g, '');
			const formattedNum = num ? Number(num).toLocaleString() : '';

			if (countFields.includes(id)) {
				outputElement.textContent = formattedNum ? formattedNum + 'íšŒ' : '';
			} else if (scoreFields.includes(id)) {
				outputElement.textContent = formattedNum ? formattedNum + 'ì ' : '';
			}else if (unitFields.includes(id)) {
            outputElement.textContent = formattedNum ? formattedNum + 'ê°œ' : '';
			}else if (id === 'in-days') {
            outputElement.textContent = formattedNum ? formattedNum + 'ì¼ ì§¸!' : '';
			}else if (id === 'in-students') {
            outputElement.textContent = formattedNum ? formattedNum + 'ëª…' : '';
			}	else if (id === 'in-eligma') {
            outputElement.textContent = formattedNum ? `ì—˜ë¦¬ê·¸ë§ˆ ${formattedNum}ê°œ` : '';
			}else if(id === 'in-level') {
            outputElement.textContent = formattedNum ? 'Lv. ' + formattedNum : '';
			}else if (id === 'in-mastery') {
            outputElement.textContent = formattedNum ? `${formattedNum}ì¥` : '';
			}else if (id === 'in-pyroxene') {
				outputElement.textContent = formattedNum ? `ì²­íœ˜ì„ ${formattedNum}ê°œ` : '';
			} else if (id === 'in-credit') {
				outputElement.textContent = formattedNum ? `${formattedNum}í¬ë ˆë”§ í¬ì¸íŠ¸` : '';
			} else if (id === 'in-ap') {
				outputElement.textContent = formattedNum ? `AP ${formattedNum}` : '';
			} 
			else {
				outputElement.textContent = value;
			}
		}

    const favInput = document.getElementById('in-fav-raw');
    const favOutput = document.getElementById('fav-list-container');
    favInput.value = savedFavText;
    updateFavOutput(); 
    favInput.addEventListener('input', () => {
        updateFavOutput();
        localStorage.setItem('ba_receipt_fav', favInput.value);
    });
    function updateFavOutput() { favOutput.textContent = favInput.value; }

    const raidContainer = document.getElementById('raid-select-container');
    const trophyOutput = document.getElementById('trophy-list-output');
	
    window.fillAllRaids = function(storageKey, value) {
        
        const isGrand = (storageKey === 'ba_receipt_grand_raid');
        const seasonList = isGrand ? grandRaidSeasons : raidSeasons;
        const dataObj = isGrand ? savedGrandRaidData : savedRaidData;

        seasonList.forEach(season => {
            dataObj[season] = value;
        });

        localStorage.setItem(storageKey, JSON.stringify(dataObj));
        
        if(isGrand) renderGrandRaidInputs();
        else renderRaidInputs();
    }

    function renderRaidInputs() {
        raidContainer.innerHTML = '';
        raidSeasons.forEach((season) => {
            const savedRank = savedRaidData[season] || "none";
            const div = document.createElement('div');
            div.className = 'raid-input-item';
            div.innerHTML = `
                <span class="raid-label">${season}</span>
                <select class="raid-select" onchange="updateRaidData('${season}', this.value)">
                    <option value="none" ${savedRank === 'none' ? 'selected' : ''}>ë¯¸ì°¸ì—¬</option>
                    <option value="í”Œë˜í‹°ë„˜" ${savedRank === 'í”Œë˜í‹°ë„˜' ? 'selected' : ''}>í”Œë˜í‹°ë„˜</option>
                    <option value="ê³¨ë“œ" ${savedRank === 'ê³¨ë“œ' ? 'selected' : ''}>ê³¨ë“œ</option>
                    <option value="ì‹¤ë²„" ${savedRank === 'ì‹¤ë²„' ? 'selected' : ''}>ì‹¤ë²„</option>
                    <option value="ë¸Œë¡ ì¦ˆ" ${savedRank === 'ë¸Œë¡ ì¦ˆ' ? 'selected' : ''}>ë¸Œë¡ ì¦ˆ</option>
                </select>
            `;
            raidContainer.appendChild(div);
        });
        renderRaidReceipt();
    }
    window.updateRaidData = function(s, v) {
        savedRaidData[s] = v;
        localStorage.setItem('ba_receipt_raid', JSON.stringify(savedRaidData));
        renderRaidReceipt();
    };
    function renderRaidReceipt() {
        let html = '';
        raidSeasons.forEach(season => {
            const rank = savedRaidData[season];
            if (rank && rank !== 'none') {
                html += `<div class="trophy-row"><span class="trophy-name">â€¢ ${season}</span><span class="trophy-rank">${rank}</span></div>`;
            }
        });
        trophyOutput.innerHTML = html;
    }

    const grandRaidContainer = document.getElementById('grand-raid-select-container');
    const grandRaidOutput = document.getElementById('grand-raid-list-output');

    function renderGrandRaidInputs() {
        grandRaidContainer.innerHTML = '';
        grandRaidSeasons.forEach((season) => {
            const savedRank = savedGrandRaidData[season] || "none";
            const div = document.createElement('div');
            div.className = 'raid-input-item';
            div.innerHTML = `
                <span class="raid-label">${season}</span>
                <select class="raid-select" onchange="updateGrandRaidData('${season}', this.value)">
                    <option value="none" ${savedRank === 'none' ? 'selected' : ''}>ë¯¸ì°¸ì—¬</option>
                    <option value="í”Œë˜í‹°ë„˜" ${savedRank === 'í”Œë˜í‹°ë„˜' ? 'selected' : ''}>í”Œë˜í‹°ë„˜</option>
                    <option value="ê³¨ë“œ" ${savedRank === 'ê³¨ë“œ' ? 'selected' : ''}>ê³¨ë“œ</option>
                    <option value="ì‹¤ë²„" ${savedRank === 'ì‹¤ë²„' ? 'selected' : ''}>ì‹¤ë²„</option>
                    <option value="ë¸Œë¡ ì¦ˆ" ${savedRank === 'ë¸Œë¡ ì¦ˆ' ? 'selected' : ''}>ë¸Œë¡ ì¦ˆ</option>
                </select>
            `;
            grandRaidContainer.appendChild(div);
        });
        renderGrandRaidReceipt();
    }
    window.updateGrandRaidData = function(s, v) {
        savedGrandRaidData[s] = v;
        localStorage.setItem('ba_receipt_grand_raid', JSON.stringify(savedGrandRaidData));
        renderGrandRaidReceipt();
    };
    function renderGrandRaidReceipt() {
        let html = '';
        grandRaidSeasons.forEach(season => {
            const rank = savedGrandRaidData[season];
            if (rank && rank !== 'none') {
                html += `<div class="trophy-row"><span class="trophy-name">â€¢ ${season}</span><span class="trophy-rank">${rank}</span></div>`;
            }
        });
        grandRaidOutput.innerHTML = html;
    }

    const elimRaidContainer = document.getElementById('elimination-raid-select-container');
    const elimRaidOutput = document.getElementById('elimination-raid-list-output');

    function renderElimRaidInputs() {
        elimRaidContainer.innerHTML = '';
        eliminationRaidSeasons.forEach((season) => {
            const savedVal = savedEliminationRaidData[season] || "";
            const div = document.createElement('div');
            div.className = 'raid-input-item';
            div.innerHTML = `
                <span class="raid-label">${season}</span>
                <input type="text" class="raid-num-input" placeholder="ë‹¨ê³„" value="${savedVal}" oninput="updateElimRaidData('${season}', this.value)">
            `;
            elimRaidContainer.appendChild(div);
        });
        renderElimRaidReceipt();
    }
    window.updateElimRaidData = function(s, v) {
        savedEliminationRaidData[s] = v;
        localStorage.setItem('ba_receipt_elim_raid', JSON.stringify(savedEliminationRaidData));
        renderElimRaidReceipt();
    }
    function renderElimRaidReceipt() {
        let html = '';
        eliminationRaidSeasons.forEach(season => {
            const val = savedEliminationRaidData[season];
            if (val && val.trim() !== "") {
                html += `<div class="trophy-row"><span class="trophy-name">â€¢ ${season}</span><span class="trophy-rank">${val}ë‹¨ê³„</span></div>`;
            }
        });
        elimRaidOutput.innerHTML = html;
    }

	function renderMainStoryInputs() {
        const inputContainer = document.getElementById('main-story-input-container');
        if (inputContainer.innerHTML.trim() !== "") return;

        let inputHtml = '';
        mainStoryList.forEach(item => {
            const ch = savedMainStory[item.key + '_ch'] || '';
            const ep = savedMainStory[item.key + '_ep'] || '';
            inputHtml += `
                <div class="story-input-row">
                    <span class="story-label">${item.name}</span>
                    <div class="story-inputs">
                        <input type="text" class="input-mini" value="${ch}" oninput="updateMainStory('${item.key}', 'ch', this.value)"> ì¥
                        <input type="text" class="input-mini" value="${ep}" oninput="updateMainStory('${item.key}', 'ep', this.value)"> í™”
                    </div>
                </div>`;
        });
        inputContainer.innerHTML = inputHtml;
        renderMainStoryReceipt();
    }

    window.updateMainStory = function(key, type, val) {
        savedMainStory[key + '_' + type] = val;
        localStorage.setItem('ba_receipt_main_story', JSON.stringify(savedMainStory));
        renderMainStoryReceipt();
    }

    function renderMainStoryReceipt() {
        const outputContainer = document.getElementById('main-story-output-container');
        const section = document.getElementById('section-main-story');
        let outputHtml = '';
        let hasData = false;

        mainStoryList.forEach(item => {
            const ch = savedMainStory[item.key + '_ch'] || '';
            const ep = savedMainStory[item.key + '_ep'] || '';
            if (ch || ep) {
                hasData = true;
                outputHtml += `
                    <div class="record-row">
                        <span class="record-label" style="padding-left:8px;">â€¢ ${item.name}</span>
                        <span class="record-value">${ch ? ch + 'ì¥ ' : ''}${ep ? ep + 'í™” ' : ''}ì™„ë£Œ</span>
                    </div>`;
            }
        });
        outputContainer.innerHTML = outputHtml;
        section.style.display = hasData ? 'block' : 'none';
    }

    function renderEventStory() {
        const inputContainer = document.getElementById('event-story-input-container');
        const outputContainer = document.getElementById('event-story-output-container');
        const section = document.getElementById('section-event-story');
        
        let inputHtml = '';
        let outputHtml = '';
        let hasData = false;

        eventStoryList.forEach(item => {
            const ep = savedEventStory[item.key] || '';
            
            inputHtml += `
                <div class="story-input-row">
                    <span class="story-label">â€¢ ${item.name}</span>
                    <div class="story-inputs">
                        <input type="text" class="input-mini" value="${ep}" oninput="updateEventStory('${item.key}', this.value)"> í™”
                    </div>
                </div>`;

            if (ep) {
                hasData = true;
                outputHtml += `
                    <div class="record-row">
                        <span class="record-label" style="padding-left:8px;">â€¢ ${item.name}</span>
                        <span class="record-value">${ep}í™” ì™„ë£Œ</span>
                    </div>`;
            }
        });

        inputContainer.innerHTML = inputHtml;
        outputContainer.innerHTML = outputHtml;
        section.style.display = hasData ? 'block' : 'none';
    }
    window.updateEventStory = function(key, val) {
        savedEventStory[key] = val;
        localStorage.setItem('ba_receipt_event_story', JSON.stringify(savedEventStory));
        renderEventStoryOnlyOutput();
    }
    function renderEventStoryOnlyOutput() {
        const outputContainer = document.getElementById('event-story-output-container');
        const section = document.getElementById('section-event-story');
        let outputHtml = '';
        let hasData = false;
        
        eventStoryList.forEach(item => {
            const ep = savedEventStory[item.key] || '';
            if(ep) {
                hasData = true;
                outputHtml += `
                <div class="record-row">
                    <span class="record-label" style="padding-left:8px;">â€¢ ${item.name}</span>
                    <span class="record-value">${ep}í™” ì™„ë£Œ</span>
                </div>`;
            }
        });
        outputContainer.innerHTML = outputHtml;
        section.style.display = hasData ? 'block' : 'none';
    }
	
	function renderMiniStoryInputs() {
        const inputContainer = document.getElementById('mini-story-input-container');
        if (inputContainer.innerHTML.trim() !== "") return;

        let inputHtml = '';
        miniStoryList.forEach(item => {
            const ep = savedMiniStory[item.key] || '';
            inputHtml += `
                <div class="story-input-row">
                    <span class="story-label">â€¢ ${item.name}</span>
                    <div class="story-inputs">
                        <input type="text" class="input-mini" value="${ep}" oninput="updateMiniStory('${item.key}', this.value)"> í™”
                    </div>
                </div>`;
        });
        inputContainer.innerHTML = inputHtml;
        renderMiniStoryReceipt();
    }

    window.updateMiniStory = function(key, val) {
        savedMiniStory[key] = val;
        localStorage.setItem('ba_receipt_mini_story', JSON.stringify(savedMiniStory));
        renderMiniStoryReceipt();
    }

    function renderMiniStoryReceipt() {
        const outputContainer = document.getElementById('mini-story-output-container');
        const section = document.getElementById('section-mini-story');
        let outputHtml = '';
        let hasData = false;

        miniStoryList.forEach(item => {
            const ep = savedMiniStory[item.key] || '';
            if (ep) {
                hasData = true;
                outputHtml += `
                    <div class="record-row">
                        <span class="record-label" style="padding-left:8px;">â€¢ ${item.name}</span>
                        <span class="record-value">${ep}í™” ì™„ë£Œ</span>
                    </div>`;
            }
        });
        outputContainer.innerHTML = outputHtml;
        section.style.display = hasData ? 'block' : 'none';
    }

	function renderGroupStoryInputs() {
        const inputContainer = document.getElementById('group-story-input-container');
        if (inputContainer.innerHTML.trim() !== "") return;

        let inputHtml = '';
        groupStoryList.forEach(item => {
            const ep = savedGroupStory[item.key] || '';
            inputHtml += `
                <div class="story-input-row">
                    <span class="story-label">â€¢ ${item.name}</span>
                    <div class="story-inputs">
                        <input type="text" class="input-mini" value="${ep}" oninput="updateGroupStory('${item.key}', this.value)"> í™”
                    </div>
                </div>`;
        });
        inputContainer.innerHTML = inputHtml;
        renderGroupStoryReceipt();
    }

    window.updateGroupStory = function(key, val) {
        savedGroupStory[key] = val;
        localStorage.setItem('ba_receipt_group_story', JSON.stringify(savedGroupStory));
        renderGroupStoryReceipt();
    }

    function renderGroupStoryReceipt() {
        const outputContainer = document.getElementById('group-story-output-container');
        const section = document.getElementById('section-group-story');
        let outputHtml = '';
        let hasData = false;

        groupStoryList.forEach(item => {
            const ep = savedGroupStory[item.key] || '';
            if (ep) {
                hasData = true;
                outputHtml += `
                    <div class="record-row">
                        <span class="record-label" style="padding-left:8px;">â€¢ ${item.name}</span>
                        <span class="record-value">${ep}í™” ì™„ë£Œ</span>
                    </div>`;
            }
        });
        outputContainer.innerHTML = outputHtml;
        section.style.display = hasData ? 'block' : 'none';
    }
	
    const collabManageContainer = document.getElementById('collab-manage-container');
    const collabOutputContainer = document.getElementById('collab-output-container');
    const collabSection = document.getElementById('section-collab');
    
    const collabSearchInput = document.getElementById('collab-search-input');
    const collabResultBox = document.getElementById('collab-search-results');
    const collabCountInput = document.getElementById('collab-count-input');
    let collabFocus = -1;

    let savedCollabList = JSON.parse(localStorage.getItem('ba_receipt_collab_list')) || [];

    if (collabSearchInput) {
        collabSearchInput.addEventListener('input', function() {
            const val = this.value.trim().toLowerCase();
            collabResultBox.innerHTML = '';
            collabFocus = -1;

            if (!val) { collabResultBox.style.display = 'none'; return; }

            const filtered = collabOptionsList.filter(item => item.toLowerCase().includes(val));

            if (filtered.length > 0) {
                collabResultBox.style.display = 'block';
                filtered.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'search-item';
                    div.textContent = item;
                    div.onmousedown = (e) => e.preventDefault();
                    div.onclick = () => insertCollabValue(item);
                    collabResultBox.appendChild(div);
                });
                collabFocus = 0; 
                addActive(collabResultBox.getElementsByClassName('search-item'), collabFocus);
            } else {
                collabResultBox.style.display = 'none';
            }
        });

        collabSearchInput.addEventListener('keydown', function(e) {
			let items = collabResultBox.getElementsByClassName('search-item');
            
            if (e.key === 'ArrowDown') {
                collabFocus++;
                if (collabFocus >= items.length) collabFocus = 0;
                addActive(items, collabFocus);
            } else if (e.key === 'ArrowUp') {
                collabFocus--;
                if (collabFocus < 0) collabFocus = items.length - 1;
                addActive(items, collabFocus);
            } 
             else if (e.key === 'Enter') {
                e.preventDefault();
                if (collabResultBox.style.display !== 'none' && collabFocus > -1 && items[collabFocus]) {
                    items[collabFocus].click();
                } else {
                    collabCountInput.focus();
                    collabResultBox.style.display = 'none';
                }
            } else if (e.key === 'Tab') {
                if (collabResultBox.style.display !== 'none' && collabFocus > -1 && items[collabFocus]) {
                    e.preventDefault();
                    items[collabFocus].click();
                }
            }
        });

        document.addEventListener('click', function(e) {
            if (!collabSearchInput.contains(e.target) && !collabResultBox.contains(e.target)) {
                collabResultBox.style.display = 'none';
            }
        });
    }
    
    if (collabCountInput) {
		collabCountInput.addEventListener('input', function(e) {
            let val = this.value.replace(/[^0-9]/g, '');
            if (val) {
                this.value = Number(val).toLocaleString();
            } else {
                this.value = '';
            }
        });
        collabCountInput.addEventListener('keydown', function (e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                if (e.isComposing) return;
                addSelectedCollab();
            }
        });
    }

    function insertCollabValue(val) {
        collabSearchInput.value = val;
        collabResultBox.innerHTML = '';
        collabResultBox.style.display = 'none';
        collabCountInput.focus();
    }

    function renderCollabAll() {
        collabManageContainer.innerHTML = '';
        collabOutputContainer.innerHTML = '';
        
        savedCollabList.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'gift-manage-item';
            div.draggable = true;
            
            div.ondragstart = (e) => collabDragStart(e, index, 'collab');
            div.ondragend = (e) => dragEnd(e);
            div.ondragover = (e) => dragOver(e);
            div.ondrop = (e) => collabDrop(e, index, 'collab');
            div.ondragenter = (e) => e.target.classList.add('drag-over');
            div.ondragleave = (e) => e.target.classList.remove('drag-over');

            div.innerHTML = `
                <div class="drag-handle" title="ë“œë˜ê·¸í•˜ì—¬ ì´ë™">â˜°</div>
                <div class="gift-info">
                    <span class="gift-name-text">${item.name}</span>
                    <span class="gift-count-text">${Number(item.count).toLocaleString()} ë³´ìœ </span>
                </div>
                <div class="gift-btns" style="display:flex; align-items:stretch;">
                    <button class="btn-move-gift" onclick="moveCollabUp(${index})" title="ìœ„ë¡œ">â–²</button>
                    <button class="btn-move-gift" onclick="moveCollabDown(${index})" title="ì•„ë˜ë¡œ">â–¼</button>
                    <button class="btn-remove-gift" onclick="deleteCollabItem(${index})" title="ì‚­ì œ">X</button>
                </div>
            `;
            collabManageContainer.appendChild(div);

            const outRow = document.createElement('div');
            outRow.className = 'record-row';
            outRow.innerHTML = `<span class="record-label" style="padding-left:8px;">â€¢ ${item.name}</span><span class="record-value">${Number(item.count).toLocaleString()} ë³´ìœ </span>`;
            collabOutputContainer.appendChild(outRow);
        });

        if(collabSection) collabSection.style.display = savedCollabList.length > 0 ? 'block' : 'none';
    }

	window.addSelectedCollab = function() {
        const name = collabSearchInput.value;
        
        const rawCount = collabCountInput.value;
        const count = rawCount.replace(/,/g, ''); 
        
        if(!name) { alert('ì•„ì´í…œì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
        if(!count) { alert('íšŸìˆ˜(ê°œìˆ˜)ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
        
        savedCollabList.push({ name: name, count: count });
        saveCollab();
        
        collabSearchInput.value = "";
        collabCountInput.value = "";
        collabSearchInput.focus();
    }

    window.deleteCollabItem = function(index) { savedCollabList.splice(index, 1); saveCollab(); }
    
    window.moveCollabUp = function(index) {
        if(index > 0) {
            const t = savedCollabList[index]; savedCollabList[index]=savedCollabList[index-1]; savedCollabList[index-1]=t;
            saveCollab();
        }
    }
    window.moveCollabDown = function(index) {
        if(index < savedCollabList.length-1) {
            const t = savedCollabList[index]; savedCollabList[index]=savedCollabList[index+1]; savedCollabList[index+1]=t;
            saveCollab();
        }
    }

    function saveCollab() {
        localStorage.setItem('ba_receipt_collab_list', JSON.stringify(savedCollabList));
        renderCollabAll();
    }

    function goToCollabInput() {
        if(collabSearchInput) {
            collabSearchInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
            collabSearchInput.focus(); 
        }
    }

    renderCollabAll();
	
    let savedGiftList = JSON.parse(localStorage.getItem('ba_receipt_gift_list_v2')) || [];
    
    const giftManageContainer = document.getElementById('gift-manage-container');
    const giftOutputContainer = document.getElementById('gift-sorted-output-container');
    const giftSection = document.getElementById('section-gift-output');
    
	const searchInput = document.getElementById('gift-search-input');
    const resultBox = document.getElementById('gift-search-results');
    const countInput = document.getElementById('gift-count-input');
    let currentFocus = -1;

    if (searchInput) {
        searchInput.addEventListener('input', function() {
            const val = this.value.trim().toLowerCase();
            resultBox.innerHTML = '';
            currentFocus = -1;

            if (!val) {
                resultBox.style.display = 'none';
                return;
            }

            const filtered = giftOptionsList.filter(gift => gift.toLowerCase().includes(val));

            if (filtered.length > 0) {
                resultBox.style.display = 'block';
                
                filtered.forEach((gift, index) => {
                    const div = document.createElement('div');
                    div.className = 'search-item';
                    div.textContent = gift;
                    
                    div.onmousedown = function(e) { e.preventDefault(); };
                    div.onclick = function() { insertValue(gift); };
                    
                    resultBox.appendChild(div);
                });

				currentFocus = 0;
                addActive(resultBox.getElementsByClassName('search-item'), currentFocus);

            } else {
                resultBox.style.display = 'none';
            }
        });

        searchInput.addEventListener('keydown', function(e) {
            let items = resultBox.getElementsByClassName('search-item');
            
		if (e.key === 'ArrowDown') {
                currentFocus++;
                if (currentFocus >= items.length) currentFocus = 0; 
                addActive(items, currentFocus);
            } else if (e.key === 'ArrowUp') {
                currentFocus--;
                if (currentFocus < 0) currentFocus = items.length - 1; 
                addActive(items, currentFocus);
            } else if (e.key === 'Enter') {
                if (resultBox.style.display !== 'none' && currentFocus > -1 && items[currentFocus]) {
                    e.preventDefault();
                    items[currentFocus].click();
                } else {
                    e.preventDefault();
                    countInput.focus();
                }
            } else if (e.key === 'Tab') {
                if (resultBox.style.display !== 'none' && currentFocus > -1 && items[currentFocus]) {
                    e.preventDefault();
                    items[currentFocus].click();
                }
            }
        });

        document.addEventListener('click', function(e) {
            if (!searchInput.contains(e.target) && !resultBox.contains(e.target)) {
                resultBox.style.display = 'none';
            }
        });
    }

    if (countInput) {
        countInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') addSelectedGift();
        });
    }

	function addActive(items, focusIdx) {
        if (!items) return;
        removeActive(items);
        if (focusIdx >= items.length) focusIdx = 0;
        if (focusIdx < 0) focusIdx = (items.length - 1);
        items[focusIdx].classList.add('active');
        items[focusIdx].scrollIntoView({ block: "nearest" });
    }
    function removeActive(items) {
        for (let i = 0; i < items.length; i++) items[i].classList.remove('active');
    }
    function insertValue(val) {
        searchInput.value = val;
        resultBox.innerHTML = '';
        resultBox.style.display = 'none';
        countInput.focus();
    }

		window.addSelectedGift = function() {
        const name = document.getElementById('gift-search-input').value;
        
        const rawCount = document.getElementById('gift-count-input').value;
        const count = rawCount.replace(/,/g, ''); 
        
        if(!name) { alert('ì„ ë¬¼ì„ ì…ë ¥í•˜ê±°ë‚˜ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
        if(!count) { alert('íšŸìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

        savedGiftList.push({ name: name, count: count });
        saveGiftList();
        
        document.getElementById('gift-search-input').value = "";
        document.getElementById('gift-count-input').value = "";
        document.getElementById('gift-search-results').style.display = 'none';
        
        document.getElementById('gift-search-input').focus();
    }

    window.removeGift = function(index) {
        savedGiftList.splice(index, 1);
        saveGiftList();
    }

    function saveGiftList() {
        localStorage.setItem('ba_receipt_gift_list_v2', JSON.stringify(savedGiftList));
        renderGiftAll();
    }
	
	window.moveGiftUp = function(index) {
        if (index > 0) {
            const temp = savedGiftList[index];
            savedGiftList[index] = savedGiftList[index - 1];
            savedGiftList[index - 1] = temp;
            saveGiftList();
        }
    }
	
    window.moveGiftDown = function(index) {
        if (index < savedGiftList.length - 1) {
            const temp = savedGiftList[index];
            savedGiftList[index] = savedGiftList[index + 1];
            savedGiftList[index + 1] = temp;
            saveGiftList();
        }
    }

    function renderGiftAll() {
        giftManageContainer.innerHTML = '';
        giftOutputContainer.innerHTML = '';
        
		savedGiftList.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'gift-manage-item';
            div.draggable = true;
            
            div.ondragstart = (e) => giftDragStart(e, index);
            div.ondragend = (e) => dragEnd(e);
            div.ondragover = (e) => dragOver(e);
            div.ondrop = (e) => giftDrop(e, index);
            div.ondragenter = (e) => e.target.classList.add('drag-over');
            div.ondragleave = (e) => e.target.classList.remove('drag-over');

            div.innerHTML = `
				<div class="drag-handle" title="ë“œë˜ê·¸í•˜ì—¬ ì´ë™">â˜°</div>

                <div class="gift-info">
                    <span class="gift-name-text">${item.name}</span>
                    <span class="gift-count-text">${Number(item.count).toLocaleString()}íšŒ</span>
                </div>
                
                <div class="gift-btns" style="display:flex; align-items:stretch;">
                    <button class="btn-move-gift" onclick="moveGiftUp(${index})" title="ìœ„ë¡œ">â–²</button>
                    <button class="btn-move-gift" onclick="moveGiftDown(${index})" title="ì•„ë˜ë¡œ">â–¼</button>
                    <button class="btn-remove-gift" onclick="removeGift(${index})" title="ì‚­ì œ">X</button>
                </div>
            `;
            giftManageContainer.appendChild(div);
        });

        let html = '';
        savedGiftList.forEach(item => {
            html += `<div class="record-row"><span class="record-label" style="padding-left:8px;">â€¢ ${item.name}</span><span class="record-value">${Number(item.count).toLocaleString()}íšŒ</span></div>`;
        });
        giftOutputContainer.innerHTML = html;
        if(giftSection) giftSection.style.display = savedGiftList.length > 0 ? 'block' : 'none';
    }

	let draggingIndex = null;

    function dragEnd(e) {
        e.target.classList.remove('dragging');
        const items = document.querySelectorAll('.gift-manage-item, .dynamic-list-item, .manage-item');
        items.forEach(item => item.classList.remove('drag-over'));
    }
	function dragOver(e) {
        e.preventDefault(); 
        e.dataTransfer.dropEffect = "move";

        const scrollable = e.target.closest('#gift-manage-container, #collab-manage-container, #collab-input-container, .student-manage-list');

        if (!scrollable) return;

        const rect = scrollable.getBoundingClientRect();
        const mouseY = e.clientY; 
        
        const threshold = 150;
        const speed = 25;

        if (mouseY < rect.top + threshold) {
            scrollable.scrollTop -= speed;
        } 
        else if (mouseY > rect.bottom - threshold) {
            scrollable.scrollTop += speed;
        }
    }

    let giftDragIndex = null;
    function giftDragStart(e, index) {
        giftDragIndex = index;
        e.dataTransfer.effectAllowed = "move";
        setTimeout(() => e.target.classList.add('dragging'), 0);
    }
    function giftDrop(e, dropIndex) {
        e.preventDefault();
        if (giftDragIndex === null || giftDragIndex === dropIndex) return;
        const item = savedGiftList[giftDragIndex];
        savedGiftList.splice(giftDragIndex, 1);
        savedGiftList.splice(dropIndex, 0, item);
        giftDragIndex = null;
        saveGiftList();
    }

    let collabDragIndex = null;
    function collabDragStart(e, index) {
        collabDragIndex = index;
        e.dataTransfer.effectAllowed = "move";
        setTimeout(() => e.target.classList.add('dragging'), 0);
    }
    function collabDrop(e, dropIndex) {
        e.preventDefault();
        if (collabDragIndex === null || collabDragIndex === dropIndex) return;
        const item = savedCollabList[collabDragIndex];
        savedCollabList.splice(collabDragIndex, 1);
        savedCollabList.splice(dropIndex, 0, item);
        collabDragIndex = null;
        if(typeof saveCollab === 'function') saveCollab(true); 
    }
    
    renderGiftAll();

    function renderAll() {
        renderReceipt();
        renderManageList();
        renderRaidInputs();
        renderGrandRaidInputs();
        renderElimRaidInputs();
        renderMainStoryInputs();
        renderEventStory();
		renderMiniStoryInputs();
        renderGroupStoryInputs();
		renderCollabAll();
		renderGiftAll();
    }

    function renderReceipt() {
        const container = document.getElementById('student-list-container');
        container.innerHTML = "";
        
        studentData.forEach(student => {
            let momoRow = "";
            if (student.momo && student.momo !== "") {
                momoRow = `<div class="record-row"><span class="record-label">ã†ëª¨ëª¨í†¡ ì§„í–‰ë„</span><span class="record-value">${student.momo}</span></div>`;
            }

            const html = `
            <div class="student-entry">
                <div class="student-name">${student.name}</div>
                <div class="record-row"><span class="record-label">ã†ìŠ¤í‚¬ ì„±ì¥</span><span class="record-value">${student.skill}</span></div>
                ${momoRow} </div>`;
            container.innerHTML += html;
        });
    }

    function renderManageList() {
        const listContainer = document.getElementById('manage-list-container');
        listContainer.innerHTML = "";
        
        studentData.forEach((student, index) => {
            const div = document.createElement('div');
            div.className = 'gift-manage-item'; 
            div.draggable = true;
            
            div.ondragstart = (e) => studentDragStart(e, index);
            div.ondragend = (e) => dragEnd(e);
            div.ondragover = (e) => dragOver(e);
            div.ondrop = (e) => studentDrop(e, index);
            div.ondragenter = (e) => e.target.classList.add('drag-over');
            div.ondragleave = (e) => e.target.classList.remove('drag-over');
            
            let shortSkill = student.skill.replace('EX. ', '').replace(/MAX/g, 'M').replace(/Lv\. /g, '').replace(/ \/ /g, '/');
            
            let momoText = ""; 
            const momoMatch = student.momo.match(/EP \d+/);
            if(momoMatch) {
                momoText = ` (${momoMatch[0]})`;
            }

            const fullText = `${student.name} (${shortSkill})${momoText}`;

            div.innerHTML = `
                <div class="drag-handle" title="ë“œë˜ê·¸í•˜ì—¬ ì´ë™">â˜°</div>

                <div class="gift-info">
                    <span class="gift-name-text" style="font-weight:bold;">${fullText}</span>
                </div>
                
                <div style="display:flex; align-items:center;">
                    <button class="btn-edit-student" onclick="startEdit(${index})" title="ìˆ˜ì •">âœ</button>
                    <button class="btn-move-gift" onclick="moveStudentUp(${index})" title="ìœ„ë¡œ">â–²</button>
                    <button class="btn-move-gift" onclick="moveStudentDown(${index})" title="ì•„ë˜ë¡œ">â–¼</button>
                    <button class="btn-remove-gift" onclick="deleteStudent(${index})" title="ì‚­ì œ">X</button>
                </div>
            `;
            listContainer.appendChild(div);
        });
		
        const countDisplay = document.getElementById('student-count-display');
        if (countDisplay) {
            if (studentData.length > 0) {
                countDisplay.innerHTML = `ì…ë ¥ëœ í•™ìƒ ìˆ˜: <span style="color:#000; font-weight:bold;">${studentData.length}</span>ëª…`;
                countDisplay.style.display = 'block';
            } else {
                countDisplay.style.display = 'none';
            }
        }
    }

    window.moveStudentUp = function(index) {
        if (index > 0) {
            const temp = studentData[index];
            studentData[index] = studentData[index - 1];
            studentData[index - 1] = temp;
            saveAndRender();
        }
    }

    window.moveStudentDown = function(index) {
        if (index < studentData.length - 1) {
            const temp = studentData[index];
            studentData[index] = studentData[index + 1];
            studentData[index + 1] = temp;
            saveAndRender();
        }
    }

    let studentDragIndex = null;

    function studentDragStart(e, index) {
        studentDragIndex = index;
        e.dataTransfer.effectAllowed = "move";
        e.target.classList.add('dragging');
    }

    function studentDrop(e, dropIndex) {
        e.preventDefault();
        if (studentDragIndex === null || studentDragIndex === dropIndex) return;

        const item = studentData[studentDragIndex];
        studentData.splice(studentDragIndex, 1);
        studentData.splice(dropIndex, 0, item);

        studentDragIndex = null;
        saveAndRender();
    }

    function addOrUpdateStudent() {
        const name = document.getElementById('new-name').value;
        const level = document.getElementById('new-lvl').value;
        const star = document.getElementById('new-star').value;
        let ex = document.getElementById('sk-ex').value;
        let s1 = document.getElementById('sk-1').value;
        let s2 = document.getElementById('sk-2').value;
        let s3 = document.getElementById('sk-3').value;
        const momoEp = document.getElementById('new-momo').value;

        if(!name) { alert("í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }

        const formatSkill = (val) => {
            const v = val.trim();
            if (v.toUpperCase() === 'M') return 'MAX';
            if (/^\d+$/.test(v)) return `Lv. ${v}`;
            return v;
        };

        const skillString = `EX. ${formatSkill(ex)} / ${formatSkill(s1)} / ${formatSkill(s2)} / ${formatSkill(s3)}`;
        let starString = star;
        if(star.startsWith("ì „ë¬´")) {
            const weaponStar = star.replace("ì „ë¬´", "");
            starString = `5ì„± ê³ ìœ  ë¬´ê¸° ${weaponStar}ì„±`;
        } 
        
        const finalName = `${name} (Lv. ${level}, ${starString})`;
		let finalMomo = "";
        if (momoEp !== "none") {
            finalMomo = `ëª¨ëª¨í†¡ ì¸ì—°ìŠ¤í† ë¦¬ EP ${momoEp} ì™„ë£Œ`;
        }
        
        const newEntry = { name: finalName, skill: skillString, momo: finalMomo };

        if(editingIndex === -1) {
            studentData.push(newEntry);
        } else {
            studentData[editingIndex] = newEntry;
            exitEditMode();
        }
        saveAndRender();
        
        document.getElementById('new-name').value = '';
        document.getElementById('sk-ex').value = 'M';
        document.getElementById('sk-1').value = 'M';
        document.getElementById('sk-2').value = 'M';
        document.getElementById('sk-3').value = 'M';
        document.getElementById('new-name').focus();
    }

	function startEdit(index) {
        editingIndex = index;
        const data = studentData[index];

        const regex = /^(.*) \(Lv\. (\d+), (.*)\)$/;
        const match = data.name.match(regex);
        
        if(match) {
            document.getElementById('new-name').value = match[1];
            document.getElementById('new-lvl').value = match[2];
            
            let starValue = match[3]; 
            if(starValue.includes("ê³ ìœ  ë¬´ê¸°")) {
                const weaponStar = starValue.replace(/[^0-9]/g, "").slice(-1);
                starValue = "ì „ë¬´" + weaponStar;
            }
            document.getElementById('new-star').value = starValue;
        } else {
            document.getElementById('new-name').value = data.name;
        }

        const skills = data.skill.replace("EX. ", "").split(" / ");
        if(skills.length === 4) {
            const formatBack = (val) => val === 'MAX' ? 'M' : val.replace("Lv. ", "");
            document.getElementById('sk-ex').value = formatBack(skills[0]);
            document.getElementById('sk-1').value = formatBack(skills[1]);
            document.getElementById('sk-2').value = formatBack(skills[2]);
            document.getElementById('sk-3').value = formatBack(skills[3]);
        }
        
		if (data.momo === "") {
            document.getElementById('new-momo').value = "none";
        } else {
            const momoMatch = data.momo.match(/EP (\d+)/);
            if(momoMatch) {
                document.getElementById('new-momo').value = momoMatch[1];
            }
        }

        const btn = document.getElementById('main-btn');
        btn.textContent = "ğŸ”„ ìˆ˜ì • ì™„ë£Œ (ì €ì¥)";
        btn.classList.add('edit-mode');

		const nameInput = document.getElementById('new-name');
        if (nameInput) {
            nameInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
            nameInput.focus();
		}
    }

    function exitEditMode() {
        editingIndex = -1;
        const btn = document.getElementById('main-btn');
        btn.textContent = "â¬‡ ëª©ë¡ì— ì¶”ê°€í•˜ê¸°";
        btn.classList.remove('edit-mode');
    }

    function deleteStudent(index) {
        if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            studentData.splice(index, 1);
            if(editingIndex === index) exitEditMode();
            saveAndRender();
        }
    }

    function saveAndRender() {
        localStorage.setItem('ba_receipt_students', JSON.stringify(studentData));
        renderAll();
    }

    function resetAllData() {
        if(confirm("ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ê³  ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            localStorage.removeItem('ba_receipt_students');
            localStorage.removeItem('ba_receipt_basic');
            localStorage.removeItem('ba_receipt_fav');
            localStorage.removeItem('ba_receipt_raid'); 
            localStorage.removeItem('ba_receipt_grand_raid'); 
            localStorage.removeItem('ba_receipt_elim_raid'); 
            localStorage.removeItem('ba_receipt_main_story');
            localStorage.removeItem('ba_receipt_event_story');
			localStorage.removeItem('ba_receipt_mini_story');
            localStorage.removeItem('ba_receipt_group_story');
			localStorage.removeItem('ba_receipt_collab_list');
			localStorage.removeItem('ba_receipt_gift_list_v2');
            location.reload();
        }
    }

    function saveReceipt() {
        const captureElement = document.getElementById('capture-area');
        document.querySelector('.preview-panel').scrollTop = 0;
        html2canvas(captureElement, { 
            scale: 2, useCORS: true, backgroundColor: "#ffffff",
            windowWidth: document.body.scrollWidth,
            windowHeight: document.body.scrollHeight
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'BlueArchive_Receipt.png';
            link.href = canvas.toDataURL("image/png");
            link.click();
        });
    }

	function previewReceipt() {
        const captureElement = document.getElementById('capture-area');

        document.querySelector('.preview-panel').scrollTop = 0;
		
        html2canvas(captureElement, { 
            scale: 2,
            useCORS: true, 
            backgroundColor: "#ffffff",
            windowWidth: document.body.scrollWidth,
            windowHeight: document.body.scrollHeight
        }).then(canvas => {
            const imgData = canvas.toDataURL("image/png");

            const win = window.open('', '_blank');

            win.document.write(`
                <!DOCTYPE html>
                <html lang="ko">
                <head>
                    <title>ì˜ìˆ˜ì¦ ë¯¸ë¦¬ë³´ê¸°</title>
                    <style>
                        body { 
                            background-color: #333; 
                            display: flex; 
                            justify-content: center; 
                            align-items: flex-start; 
                            padding: 50px; 
                            margin: 0; 
                        }
                        img {
                            max-width: 100%; 
                            height: auto;
                            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
                        }
                    </style>
                </head>
                <body>
                    <img src="${imgData}" alt="ì˜ìˆ˜ì¦ ë¯¸ë¦¬ë³´ê¸°">
                </body>
                </html>
            `);
            win.document.close();
        });
    }
	
	function goToGiftInput() {
        const input = document.getElementById('gift-search-input');
        if (input) {
            input.scrollIntoView({ behavior: 'smooth', block: 'center' });
            input.focus(); 
        }
    }
	
	function goToStudentInput() {
        const input = document.getElementById('new-name');
        if (input) {
            input.scrollIntoView({ behavior: 'smooth', block: 'center' });
            input.focus();
        }
    }
	
    renderAll();
	
	const giftCountInput = document.getElementById('gift-count-input');

    if (countInput) {
        giftCountInput.addEventListener('input', function(e) {
            let val = this.value.replace(/[^0-9]/g, '');
            if (val) {
                this.value = Number(val).toLocaleString();
            } else {
                this.value = '';
            }
        });
        countInput.addEventListener('keydown', function (e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                if (e.isComposing) return;
                addSelectedGift();
            }
        });
    }
	
    function downloadBackup() {
        const backupData = {
            basic: localStorage.getItem('ba_receipt_basic'),
            students: localStorage.getItem('ba_receipt_students'),
            fav: localStorage.getItem('ba_receipt_fav'),
            raid: localStorage.getItem('ba_receipt_raid'),
            grand: localStorage.getItem('ba_receipt_grand_raid'),
            elim: localStorage.getItem('ba_receipt_elim_raid'),
            main: localStorage.getItem('ba_receipt_main_story'),
            event: localStorage.getItem('ba_receipt_event_story'),
            mini: localStorage.getItem('ba_receipt_mini_story'),
            group: localStorage.getItem('ba_receipt_group_story'),
            collab: localStorage.getItem('ba_receipt_collab_list'),
            gift: localStorage.getItem('ba_receipt_gift_list_v2')
        };

        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(backupData));
        const downloadAnchorNode = document.createElement('a');

        const date = new Date();
        const dateStr = date.getFullYear() + ("0" + (date.getMonth() + 1)).slice(-2) + ("0" + date.getDate()).slice(-2);
        
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "BlueArchive_Receipt_BackUp_" + dateStr + ".json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }
	
    function loadBackup(input) {
        const file = input.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                
                if (confirm("í˜„ì¬ ë°ì´í„°ë¥¼ ë®ì–´ì“°ê³  ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?\n(ë³µêµ¬ í›„ í˜ì´ì§€ê°€ ìƒˆë¡œê³ ì¹¨ë©ë‹ˆë‹¤)")) {
                    if(data.basic) localStorage.setItem('ba_receipt_basic', data.basic);
                    if(data.students) localStorage.setItem('ba_receipt_students', data.students);
                    if(data.fav) localStorage.setItem('ba_receipt_fav', data.fav);
                    if(data.raid) localStorage.setItem('ba_receipt_raid', data.raid);
                    if(data.grand) localStorage.setItem('ba_receipt_grand_raid', data.grand);
                    if(data.elim) localStorage.setItem('ba_receipt_elim_raid', data.elim);
                    if(data.main) localStorage.setItem('ba_receipt_main_story', data.main);
                    if(data.event) localStorage.setItem('ba_receipt_event_story', data.event);
                    if(data.mini) localStorage.setItem('ba_receipt_mini_story', data.mini);
                    if(data.group) localStorage.setItem('ba_receipt_group_story', data.group);
                    if(data.collab) localStorage.setItem('ba_receipt_collab_list', data.collab);
                    if(data.gift) localStorage.setItem('ba_receipt_gift_list_v2', data.gift);
                    
                    alert("ë°ì´í„° ë³µêµ¬ ì™„ë£Œ!");
                    location.reload();
                }
            } catch (err) {
                alert("ì˜ëª»ëœ íŒŒì¼ì´ê±°ë‚˜ ì†ìƒëœ ë°ì´í„°ì…ë‹ˆë‹¤.");
                console.error(err);
            }
            input.value = ''; 
        };
        reader.readAsText(file);
    }
	
</script>
</body>

</html>

